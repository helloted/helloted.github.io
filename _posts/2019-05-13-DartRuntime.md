---
layout:     post
category:   Flutter
title:      "Dart内存机制"
subtitle:   "Dart的内存管理"
date:       2019-05-13 12:00:00
author:     "Ted"
header-img: "img/default.jpg"
---

### 一、移动端的内存回收机制

常见的垃圾回收算法有引用计数法（Reference Counting）、标注并清理（Mark and Sweep GC）、拷贝（Copying GC）和逐代回收（Generational GC）等算法。

#### 1、iOS端

iOS采用引用计数算法回收内存，当对象引用计数为0时，对象会执行反初始化方法并被回收。如果两个对象互相引用对方，就会造成循环强引用，导致内存泄漏。

#### 2、Android端

Android系统采用的是标注并删除和拷贝GC，并不是大多数JVM实现里采用的逐代回收算法，根搜索算法回收内存，该算法通过GC Roots作为起点搜索，搜索通过的路径称为引用链，当一个对象没有被GC Roots的引用链连接的时候，这个对象就会被回收。即使A和B两个对象互相引用对方，只要A和B都不在引用链上，这两个对象都会被回收。

下图中的每个圆节点代表对象，箭头代表可达路径，当圆节点与 GC Roots 存在可达路径时，表示无法回收(黄色圆节点)，反之则可以回收(蓝色圆节点)。

![](/img/Simple_7/47.png)

> ##### GC Root
>
> - 虚拟机栈（栈帧中的局部变量）中的引用的对象。
> - 方法区域中的类静态属性引用的对象。
> - 方法区域中常量引用的对象。
> - 本地方法栈中 JNI（Native 方法）的引用的对象。
> - 运行中线程引用的对象

