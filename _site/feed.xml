<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.2">Jekyll</generator><link href="http://www.helloted.com/feed.xml" rel="self" type="application/atom+xml" /><link href="http://www.helloted.com/" rel="alternate" type="text/html" /><updated>2018-05-30T15:41:24+08:00</updated><id>http://www.helloted.com/</id><title type="html">Helloted Blog</title><subtitle>Write your site description here. It will be used as your sites meta description as well!</subtitle><entry><title type="html">å‘å¸ƒåº“åˆ°cocoapod</title><link href="http://www.helloted.com/%E5%B7%A5%E5%85%B7/2018/05/24/cocoapod/" rel="alternate" type="text/html" title="å‘å¸ƒåº“åˆ°cocoapod" /><published>2018-05-24T20:00:00+08:00</published><updated>2018-05-24T20:00:00+08:00</updated><id>http://www.helloted.com/%E5%B7%A5%E5%85%B7/2018/05/24/cocoapod</id><content type="html" xml:base="http://www.helloted.com/%E5%B7%A5%E5%85%B7/2018/05/24/cocoapod/">&lt;h4 id=&quot;1åˆ›å»ºpodspecæ–‡ä»¶&quot;&gt;1ã€åˆ›å»ºpodspecæ–‡ä»¶&lt;/h4&gt;

&lt;p&gt;åœ¨ä½ è¦å‘å¸ƒçš„åº“çš„æ ¹ç›®å½•ä¸‹è¿è¡Œä¸‹é¢çš„ğŸ‘‡çš„å‘½ä»¤è¡Œ&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pod spec create &amp;lt;pod_name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;pod_nameæ˜¯ä½ è¦å‘å¸ƒçš„åº“çš„åç§°&lt;/p&gt;

&lt;p&gt;å‘½ä»¤è¡Œè¿‡åä¼šåœ¨æ ¹ç›®å½•ç”Ÿæˆä¸€ä¸ªpodspecæ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å°†podspecæ–‡ä»¶å®Œå–„&lt;/p&gt;

&lt;h4 id=&quot;2ä¿®æ”¹podspecæ–‡ä»¶&quot;&gt;2ã€ä¿®æ”¹podspecæ–‡ä»¶&lt;/h4&gt;

&lt;p&gt;podspecæ–‡ä»¶é‡Œé¢çš„å±æ€§éƒ½æœ‰è§£é‡Šç”¨é€”ï¼Œä¸æ˜¯æ‰€æœ‰çš„å±æ€§éƒ½å¿…å¡«ï¼Œå‚è€ƒè‡ªå·±çš„éœ€è¦&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nameï¼šæ¡†æ¶å
versionï¼šå½“å‰ç‰ˆæœ¬ï¼ˆæ³¨æ„ï¼Œæ˜¯å½“å‰ç‰ˆæœ¬ï¼Œå‡å¦‚ä½ åç»­æ›´æ–°äº†æ–°ç‰ˆæœ¬ï¼Œéœ€è¦ä¿®æ”¹æ­¤å¤„ï¼‰
summaryï¼šç®€è¦æè¿°ï¼Œåœ¨pod search ZCPKitçš„æ—¶å€™ä¼šæ˜¾ç¤ºè¯¥ä¿¡æ¯ã€‚
descriptionï¼šè¯¦ç»†æè¿°
homepageï¼šé¡µé¢é“¾æ¥
licenseï¼šå¼€æºåè®®
authorï¼šä½œè€…
sourceï¼šæºç gitåœ°å€
platformï¼šæ”¯æŒæœ€ä½iosç‰ˆæœ¬
source_filesï¼šæºæ–‡ä»¶ï¼ˆå¯ä»¥åŒ…å«.hå’Œ.mï¼‰
public_header_filesï¼šå¤´æ–‡ä»¶(.hæ–‡ä»¶)
resourcesï¼šèµ„æºæ–‡ä»¶ï¼ˆé…ç½®çš„æ–‡ä»¶éƒ½ä¼šè¢«æ”¾åˆ°mainBundleä¸­ï¼‰
resource_bundlesï¼šèµ„æºæ–‡ä»¶ï¼ˆé…ç½®çš„æ–‡ä»¶ä¼šæ”¾åˆ°ä½ è‡ªå·±æŒ‡å®šçš„bundleä¸­ï¼‰
frameworksï¼šä¾èµ–çš„ç³»ç»Ÿæ¡†æ¶
vendored_frameworksï¼šä¾èµ–çš„éç³»ç»Ÿæ¡†æ¶
librariesï¼šä¾èµ–çš„ç³»ç»Ÿåº“
vendored_librariesï¼šä¾èµ–çš„éç³»ç»Ÿçš„é™æ€åº“
dependencyï¼šä¾èµ–çš„ä¸‰æ–¹åº“
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;3æ ¡éªŒpodspecæ–‡ä»¶&quot;&gt;3ã€æ ¡éªŒpodspecæ–‡ä»¶&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pod lib lint ï¼ˆä»æœ¬åœ°éªŒè¯ä½ çš„podèƒ½å¦é€šè¿‡éªŒè¯ï¼‰
pod spec lint ï¼ˆä»æœ¬åœ°å’Œè¿œç¨‹éªŒè¯ä½ çš„podèƒ½å¦é€šè¿‡éªŒè¯ï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å‡ºç°ä¸‹é¢çš„å›¾ç‰‡è¯´æ˜æ ¡éªŒæˆåŠŸï¼Œå°±å¯ä»¥å‘å¸ƒåˆ°ç½‘ä¸Šå»äº†&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_2/23.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;4æ³¨å†Œcocoapods-trunkè´¦å·&quot;&gt;4ã€æ³¨å†ŒCocoaPods Trunkè´¦å·&lt;/h4&gt;

&lt;p&gt;è¿è¡Œå‘½ä»¤&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pod trunk register helloted@live.com  'helloted'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¹‹åä¼šæ”¶åˆ°ä¸€å°é‚®ä»¶ï¼Œç‚¹å‡»éªŒè¯ä¹‹åï¼Œè¿è¡Œå‘½ä»¤å¯æŸ¥çœ‹ä¿¡æ¯&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pod trunk me
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_2/24.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;5gitæ‰“æ ‡ç­¾&quot;&gt;5ã€Gitæ‰“æ ‡ç­¾&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git tag '1.0.0' 
git push --tags 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;6å‘å¸ƒåˆ°cocoapods&quot;&gt;6ã€å‘å¸ƒåˆ°CocoaPods&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pod trunk push
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;7æŸ¥çœ‹è‡ªå·±çš„åº“&quot;&gt;7ã€æŸ¥çœ‹è‡ªå·±çš„åº“&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pod setup
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rm ~/Library/Caches/CocoaPods/search_index.json
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pod search HTLivePushKit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Ted</name></author><category term="å·¥å…·" /><summary type="html">1ã€åˆ›å»ºpodspecæ–‡ä»¶</summary></entry><entry><title type="html">Nginxæ·»åŠ ç¬¬ä¸‰æ–¹æ¨¡å—</title><link href="http://www.helloted.com/linux/2018/05/13/nginxThird/" rel="alternate" type="text/html" title="Nginxæ·»åŠ ç¬¬ä¸‰æ–¹æ¨¡å—" /><published>2018-05-13T20:00:00+08:00</published><updated>2018-05-13T20:00:00+08:00</updated><id>http://www.helloted.com/linux/2018/05/13/nginxThird</id><content type="html" xml:base="http://www.helloted.com/linux/2018/05/13/nginxThird/">&lt;p&gt;ä»¥ä¸‹æ˜¯åœ¨CentOSä¸Šé€‚ç”¨&lt;/p&gt;

&lt;h4 id=&quot;1æŸ¥çœ‹ç‰ˆæœ¬å’Œå·²ç»å®‰è£…æ¨¡å—&quot;&gt;1ã€æŸ¥çœ‹ç‰ˆæœ¬å’Œå·²ç»å®‰è£…æ¨¡å—&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nginx -V
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ä¿¡æ¯å’Œå·²ç»å®‰è£…çš„æ¨¡å—&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/34.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;2ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„çš„nginxæºç &quot;&gt;2ã€ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„çš„nginxæºç &lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cd /opt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wget http://nginx.org/download/nginx-1.12.1.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;3ä¸‹è½½åº”çš„ç¬¬ä¸‰æ–¹æ¨¡å—&quot;&gt;3ã€ä¸‹è½½åº”çš„ç¬¬ä¸‰æ–¹æ¨¡å—&lt;/h4&gt;

&lt;p&gt;ä»¥ngx-fancyindexä¸ºä¾‹&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone https://github.com/aperezdc/ngx-fancyindex.git ngx-fancyindex
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;4æŸ¥çœ‹å¯¹åº”çš„configure&quot;&gt;4ã€æŸ¥çœ‹å¯¹åº”çš„configure&lt;/h4&gt;

&lt;p&gt;è§£å‹nginxæºç &lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;tar xf nginx-1.12.2.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cd nginx-1.12.2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;5æ·»åŠ å¯¹åº”çš„æ¨¡å—&quot;&gt;5ã€æ·»åŠ å¯¹åº”çš„æ¨¡å—&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./configure --prefix=/etc/nginx \
            --sbin-path=/usr/sbin/nginx \
            --conf-path=/etc/nginx/nginx.conf \
            ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ³¨æ„ï¼Œè¿™é‡Œå¯ä»¥copyä¹‹å‰å¯¹åº”çš„é…ç½®&lt;/p&gt;

&lt;p&gt;æ·»åŠ å‘½ä»¤&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;--add-module=../ngx-fancyindex
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;../ngx-fancyindex&lt;/code&gt;æ˜¯æ¨¡å—ä¸‹è½½çš„ä½ç½®&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥æ•´ä½“çš„å‘½ä»¤åº”è¯¥æ˜¯&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./configure --prefix=/etc/nginx \
            --sbin-path=/usr/sbin/nginx \
            --conf-path=/etc/nginx/nginx.conf \
            ...
            --add-module=../ngx-fancyindex
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;6ç¼–è¯‘&quot;&gt;6ã€ç¼–è¯‘&lt;/h4&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;make &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; make &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;7å¤‡ä»½æ›¿æ¢&quot;&gt;7ã€å¤‡ä»½æ›¿æ¢&lt;/h4&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; /usr/sbin/nginx /usr/sbin/nginx.bak &lt;span class=&quot;c&quot;&gt;#å¤‡ä»½&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; /opt/nginx-1.12.1/objs/nginx /usr/sbin/nginx &lt;span class=&quot;c&quot;&gt;#æ›¿æ¢&lt;/span&gt;
systemctl restart nginx &lt;span class=&quot;c&quot;&gt;#é‡å¯ nginx æœåŠ¡&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Ted</name></author><category term="Linux" /><summary type="html">ä»¥ä¸‹æ˜¯åœ¨CentOSä¸Šé€‚ç”¨</summary></entry><entry><title type="html">H.264å°è£…æˆFLV</title><link href="http://www.helloted.com/%E7%9B%B4%E6%92%AD/2018/05/08/h264toflv/" rel="alternate" type="text/html" title="H.264å°è£…æˆFLV" /><published>2018-05-08T20:00:00+08:00</published><updated>2018-05-08T20:00:00+08:00</updated><id>http://www.helloted.com/%E7%9B%B4%E6%92%AD/2018/05/08/h264toflv</id><content type="html" xml:base="http://www.helloted.com/%E7%9B%B4%E6%92%AD/2018/05/08/h264toflv/">&lt;h3 id=&quot;ä¸€h264å’Œflv&quot;&gt;ä¸€ã€H.264å’ŒFLV&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;H.264&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;H264æ˜¯ä¸€ä¸ªä¸ªNALUå•å…ƒç»„æˆçš„ï¼Œæ¯ä¸ªå•å…ƒä»¥00 00 01 æˆ–è€… 00 00 00 01åˆ†éš”å¼€æ¥ï¼Œæ¯2ä¸ª00 00 00 01ä¹‹é—´å°±æ˜¯ä¸€ä¸ªNALUå•å…ƒã€‚æˆ‘ä»¬å®é™…ä¸Šå°±æ˜¯å°†ä¸€ä¸ªä¸ªNALUå•å…ƒå°è£…è¿›FLVæ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªNALUå•å…ƒå¼€å¤´ç¬¬ä¸€ä¸ªbyteçš„ä½5bitsè¡¨ç¤ºç€è¯¥å•å…ƒçš„ç±»å‹ï¼Œå³NAL nal_unit_typeï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#define NALU_TYPE_SLICE 1  
#define NALU_TYPE_DPA 2  
#define NALU_TYPE_DPB 3  
#define NALU_TYPE_DPC 4  
#define NALU_TYPE_IDR 5    /**å…³é”®å¸§***/  
#define NALU_TYPE_SEI 6    /*****å¢å¼ºå¸§******/       
#define NALU_TYPE_SPS 7  
#define NALU_TYPE_PPS 8  
#define NALU_TYPE_AUD 9  
#define NALU_TYPE_EOSEQ 10  
#define NALU_TYPE_EOSTREAM 11  
#define NALU_TYPE_FILL 12  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ¯ä¸ªNALUç¬¬ä¸€ä¸ªbyte &amp;amp; 0x1f å°±å¯ä»¥å¾—å‡ºå®ƒçš„ç±»å‹ï¼Œæ¯”å¦‚ä¸Šå›¾ç¬¬ä¸€ä¸ªNALUï¼š67 &amp;amp; 0x1f = 7ï¼Œåˆ™æ­¤å•å…ƒæ˜¯SPSï¼Œç¬¬ä¸‰ä¸ªï¼š68 &amp;amp; 0x1f = 8ï¼Œåˆ™æ­¤å•å…ƒæ˜¯PPSã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;FLV&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;FLVï¼ˆFlash Videoï¼‰æ˜¯Adobeå…¬å¸è®¾è®¡å¼€å‘çš„ä¸€ç§æµè¡Œçš„æµåª’ä½“æ ¼å¼ï¼Œç”±äºå…¶è§†é¢‘æ–‡ä»¶ä½“ç§¯è½»å·§ã€å°è£…ç®€å•ç­‰ç‰¹ç‚¹ï¼Œä½¿å…¶å¾ˆé€‚åˆåœ¨äº’è”ç½‘ä¸Šè¿›è¡Œåº”ç”¨ã€‚æ­¤å¤–ï¼ŒFLVå¯ä»¥ä½¿ç”¨Flash Playerè¿›è¡Œæ’­æ”¾ï¼Œè€ŒFlash Playeræ’ä»¶å·²ç»å®‰è£…åœ¨å…¨ä¸–ç•Œç»å¤§éƒ¨åˆ†æµè§ˆå™¨ä¸Šï¼Œè¿™ä½¿å¾—é€šè¿‡ç½‘é¡µæ’­æ”¾FLVè§†é¢‘ååˆ†å®¹æ˜“ã€‚ç›®å‰ä¸»æµçš„è§†é¢‘ç½‘ç«™å¦‚ä¼˜é…·ç½‘ï¼ŒåœŸè±†ç½‘ï¼Œä¹è§†ç½‘ç­‰ç½‘ç«™æ— ä¸€ä¾‹å¤–åœ°ä½¿ç”¨äº†FLVæ ¼å¼ã€‚FLVå°è£…æ ¼å¼çš„æ–‡ä»¶åç¼€é€šå¸¸ä¸ºâ€œ.flvâ€ã€‚&lt;/p&gt;

&lt;h3 id=&quot;äºŒflvçš„ç»“æ„&quot;&gt;äºŒã€FLVçš„ç»“æ„&lt;/h3&gt;

&lt;p&gt;æ€»ä½“ä¸Šçœ‹ï¼ŒFLVåŒ…æ‹¬æ–‡ä»¶å¤´ï¼ˆFile Headerï¼‰å’Œæ–‡ä»¶ä½“ï¼ˆFile Bodyï¼‰ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­æ–‡ä»¶ä½“ç”±ä¸€ç³»åˆ—çš„Tagç»„æˆã€‚å› æ­¤ä¸€ä¸ªFLVæ–‡ä»¶æ˜¯å¦‚å›¾1ç»“æ„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/33.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;ä¸‰å°è£…flv&quot;&gt;ä¸‰ã€å°è£…FLV&lt;/h3&gt;

&lt;h4 id=&quot;1h264æ–‡ä»¶åˆ‡å‰²&quot;&gt;1ã€h264æ–‡ä»¶åˆ‡å‰²&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;splitH264FileFrom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dataWithContentsOfFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//H264è£¸æ•°æ®&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Byte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Byte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264file&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Byte&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//h264æ˜¯ä¸€ä¸ªä¸ªNALUå•å…ƒç»„æˆçš„ï¼Œæ¯ä¸ªå•å…ƒä»¥00 00 01 æˆ–è€… 00 00 00 01åˆ†éš”å¼€æ¥ï¼Œæ¯2ä¸ª00 00 00 01ä¹‹é—´å°±æ˜¯ä¸€ä¸ªNALUå•å…ƒ&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264file&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//åˆ†å‰²ç¬¦&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSMutableData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;count_i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//åˆ†å‰²ç¬¦&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSMutableData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;count_i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count_i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count_i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;2å°è£…flv-header&quot;&gt;2ã€å°è£…FLV Header&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;c1&quot;&gt;// 1~9ä¸ºFLV Header&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// å‰ä¸‰ä½ 0x46 0x4c 0x56ä¸ºæ–‡ä»¶æ ‡è¯†&quot;FLV&quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;FLV&quot;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dataUsingEncoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUTF8StringEncoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// ç¬¬å››ä½æ˜¯ç‰ˆæœ¬å·&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//4&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// æµçš„ä¿¡æ¯&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//0x01--ä»£è¡¨åªæœ‰è§†é¢‘ï¼Œ0x04-ï¼åªæœ‰éŸ³é¢‘ï¼Œ0x05-ï¼éŸ³é¢‘å’Œè§†é¢‘æ··åˆ&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//5&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// æ¥ä¸‹æ¥çš„å››ä½ä¸ºHeaderçš„é•¿åº¦9Byte&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;writeIntegerToDataWithHex32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;3å°è£…spspps&quot;&gt;3ã€å°è£…SPSã€PPS&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;c1&quot;&gt;//H.264ç æµç¬¬ä¸€ä¸ª NALUæ˜¯ SPSï¼ˆåºåˆ—å‚æ•°é›†Sequence Parameter Setï¼‰&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//H.264ç æµç¬¬äºŒä¸ª NALUæ˜¯ PPSï¼ˆå›¾åƒå‚æ•°é›†Picture Parameter Setï¼‰&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;//Tag = Tag Header + Tag Data&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//TAG Head 11&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSUInteger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tagDataLength&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;topTagLen&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headerTagData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;creatflvTagHeaderWithType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FLVTagHeaderTypeVideo&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;tagDataSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tagDataLength&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeStamp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headerTagData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;//&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//18&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//18&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//18&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//18&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//18&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// AVCä¹Ÿå°±æ˜¯H264çš„è§£ç é…ç½® configuretion&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//18&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x42&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//18&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//18&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x0D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//18&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xFF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//18&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xE1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//18&lt;/span&gt;
    
    
    &lt;span class=&quot;c1&quot;&gt;// å†™å…¥å‰ä¸¤ä¸ªNALUå•å…ƒï¼Œä¹Ÿå°±æ˜¯SPSå’ŒPPS&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NALU&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSUInteger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NALULength&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NALU&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;writeIntegerToDataWithHex16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NALULength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NALU&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//18&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;NALU&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NALULength&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NALU&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;writeIntegerToDataWithHex16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NALULength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NALU&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;4æŒ‰é¡ºåºå°è£…nalu&quot;&gt;4ã€æŒ‰é¡ºåºå°è£…NALU&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;n&quot;&gt;NSInteger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;naluLength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time_h&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//åˆå§‹æ—¶é—´æˆ³&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;naluLength&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;metaFixLen&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;naluLength&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;videoTagFixLen&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// Previous Tag Size&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;writeIntegerToDataWithHex32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naluLength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// æœ¬æ¬¡tagçš„Header Dataé•¿åº¦ä¸º5+4é•¿åº¦&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;naluLength&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tagHeader&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;creatflvTagHeaderWithType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FLVTagHeaderTypeVideo&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;tagDataSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;naluLength&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeStamp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time_h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tagHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// Tag Data&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ä¸€ä¸ªbyteçš„videoä¿¡æ¯+ä¸€ä¸ªbyteçš„AVCPacket type+3ä¸ªbytesçš„æ— ç”¨æ•°æ®ï¼ˆcomposition timeï¼Œå½“AVCæ—¶æ— ç”¨ï¼Œå…¨æ˜¯0ï¼‰+ 4ä¸ªbytesçš„NALUå•å…ƒé•¿åº¦ + Nä¸ªbytesçš„NALUæ•°æ®&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NALU&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Byte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Byte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NALU&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x1f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// é«˜4bitsï¼š1ï¼Œkeyframeã€‚ ä½4bitsï¼š7ï¼Œä»£è¡¨AVC&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//1&lt;/span&gt;
            
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// é«˜4bitsï¼š2ï¼Œinter frame ï¼ŒP frameã€‚ ä½4bitsï¼š7ï¼ŒAVC NALU&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x27&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//1&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//2&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tempByte&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//3ã€4ã€5&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// NALU é•¿åº¦å†™å…¥&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;len:%ld&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NALU&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;writeIntegerToDataWithHex32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NALU&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//6ã€7ã€8ã€9&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// NALUæ•°æ®å†™å…¥&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;appendData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h264NALUArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;time_h&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time_h&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//å¯¹äºä¸€ä¸ªè£¸h264æµï¼Œæ²¡æœ‰æ—¶é—´æˆ³çš„æ¦‚å¿µï¼Œå¯ä»¥é»˜è®¤ä»¥25fpsï¼Œå³40msä¸€å¸§æ•°æ®&lt;/span&gt;
        
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//for&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;5ä¿å­˜flvæ–‡ä»¶&quot;&gt;5ã€ä¿å­˜FLVæ–‡ä»¶&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;documentPath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSSearchPathForDirectoriesInDomains&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSDocumentDirectory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSUserDomainMask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvPath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;documentPath&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;stringByAppendingPathComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;a.flv&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;writeToFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flvPath&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;atomically&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Ted</name></author><category term="ç›´æ’­" /><summary type="html">ä¸€ã€H.264å’ŒFLV</summary></entry><entry><title type="html">åœ¨iOSä¸Šæ¨æµ</title><link href="http://www.helloted.com/%E7%9B%B4%E6%92%AD/2018/05/03/librtmp/" rel="alternate" type="text/html" title="åœ¨iOSä¸Šæ¨æµ" /><published>2018-05-03T20:00:00+08:00</published><updated>2018-05-03T20:00:00+08:00</updated><id>http://www.helloted.com/%E7%9B%B4%E6%92%AD/2018/05/03/librtmp</id><content type="html" xml:base="http://www.helloted.com/%E7%9B%B4%E6%92%AD/2018/05/03/librtmp/">&lt;h3 id=&quot;ä¸€ç¼–è¯‘libåº“&quot;&gt;ä¸€ã€ç¼–è¯‘libåº“&lt;/h3&gt;

&lt;h4 id=&quot;1ç¼–è¯‘openssl&quot;&gt;1ã€ç¼–è¯‘openssl&lt;/h4&gt;

&lt;p&gt;ç¼–è¯‘librtmpéœ€è¦ç”¨åˆ°opensslï¼Œæ‰€ä»¥å…ˆç¼–è¯‘opensslï¼Œä¸‹è½½è„šæœ¬&lt;a href=&quot;https://github.com/x2on/OpenSSL-for-iPhone&quot;&gt;OpenSSL&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ç¼–è¯‘ç›®å½•ä¸‹çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;build-libssl.sh&lt;/code&gt;æ–‡ä»¶ï¼Œæ•´ä¸ªç¼–è¯‘è¿‡ç¨‹éœ€è¦ä¸€æ®µæ—¶é—´&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/27.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ–°å»ºæ–‡ä»¶å¤¹&lt;code class=&quot;highlighter-rouge&quot;&gt;librtmp&lt;/code&gt;ï¼Œå°†sslç¼–è¯‘åçš„ä¸¤ä¸ªæ–‡ä»¶å¤¹&lt;code class=&quot;highlighter-rouge&quot;&gt;lib&lt;/code&gt;ä¸&lt;code class=&quot;highlighter-rouge&quot;&gt;include&lt;/code&gt;æ‹·å…¥&lt;/p&gt;

&lt;h4 id=&quot;2ç¼–è¯‘&quot;&gt;2ã€ç¼–è¯‘&lt;/h4&gt;

&lt;p&gt;åœ¨librtmpç›®å½•ä¸‹ï¼Œ&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;touch build.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å°†ä¸‹é¢çš„è„šæœ¬å¤åˆ¶è¿›å»ï¼Œæ³¨æ„è¦ä¿®æ”¹çš„åœ°æ–¹ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;SDKVERSION&lt;/code&gt;ä¸ºå½“å‰macä¸Šæœ€æ–°çš„iOS SDKçš„ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡å¾—åˆ°&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;###########################################################################&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#  Change values here                                                                     &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;SDKVERSION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;11.2&quot;&lt;/span&gt;                                                                         
&lt;span class=&quot;c&quot;&gt;###########################################################################&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#                                                                                                              #&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Don't change anything under this line!                                                  #&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#                                                                                                              #&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;###########################################################################&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;CURRENTPATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;  
&lt;span class=&quot;nv&quot;&gt;ARCHS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;i386 x86_64 armv7 armv7s arm64&quot;&lt;/span&gt;  
&lt;span class=&quot;nv&quot;&gt;LIBRTMPREPO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;git://git.ffmpeg.org/rtmpdump&quot;&lt;/span&gt;  
&lt;span class=&quot;nv&quot;&gt;BUILDPATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CURRENTPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/build&quot;&lt;/span&gt;  
&lt;span class=&quot;nv&quot;&gt;LIBPATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CURRENTPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/lib&quot;&lt;/span&gt;  
&lt;span class=&quot;nv&quot;&gt;INCLUDEPATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CURRENTPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/include&quot;&lt;/span&gt;  
&lt;span class=&quot;nv&quot;&gt;SRCPATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CURRENTPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/src&quot;&lt;/span&gt;  
&lt;span class=&quot;nv&quot;&gt;LIBRTMP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;librtmp.a&quot;&lt;/span&gt;  
&lt;span class=&quot;nv&quot;&gt;DEVELOPER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;xcode-select &lt;span class=&quot;nt&quot;&gt;-print-path&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DEVELOPER&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then  
  &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;xcode path is not set correctly &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DEVELOPER&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; does not exist (most likely because of xcode &amp;gt; 4.3)&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;run&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;sudo xcode-select -switch &amp;lt;xcode path&amp;gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;for default installation:&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;sudo xcode-select -switch /Applications/Xcode.app/Contents/Developer&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;1
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Check whether openssl has already installed on the machine or not.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# libcrypt.a / libssl.a&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt;  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Check openssl installation'&lt;/span&gt;  
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIBPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/libcrypto.a&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIBPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/libssl.a&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;INCLUDEPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/openssl&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then  
  &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Openssl for iOS has already installed, no need to install openssl'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else  
  &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Openssl for iOS not found, will install openssl for iOS'&lt;/span&gt;
  ./build-libssl.sh
  &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Succeeded to install openssl'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Download librtmp source code from git repository&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# We assuem the user already installed git client.&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Clone librtmp git repository'&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Remove the directory if already exist&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-rf&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SRCPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/rtmpdump&quot;&lt;/span&gt;

git clone &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIBRTMPREPO&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; src/rtmpdump  
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SRCPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/rtmpdump/librtmp&quot;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;LIBRTMP_REPO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;ARCH &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCHS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;k&quot;&gt;do  
  if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;i386&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;x86_64&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;then
      &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PLATFORM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;iPhoneSimulator&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else  
      &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PLATFORM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;iPhoneOS&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;fi

  &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CROSS_TOP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEVELOPER&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/Platforms/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PLATFORM&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.platform/Developer&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CROSS_SDK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PLATFORM&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SDKVERSION&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.sdk&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;BUILD_TOOLS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEVELOPER&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Building librtmp for &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PLATFORM&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SDKVERSION&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Please wait...&quot;&lt;/span&gt;

  &lt;span class=&quot;c&quot;&gt;# add arch to CC=&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ie&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;s!AR=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;(CROSS_COMPILE)ar!AR=/usr/bin/ar!&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Makefile&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ie&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/CC=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;(CROSS_COMPILE)gcc/d&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Makefile&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;CC=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;(CROSS_COMPILE)gcc -arch &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Makefile&quot;&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CROSS_COMPILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEVELOPER&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/usr/bin/&quot;&lt;/span&gt;  
  &lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;XCFLAGS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-isysroot &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CROSS_TOP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/SDKs/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CROSS_SDK&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -miphoneos-version-min=7.0 -I&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;INCLUDEPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -arch &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;i386&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;x86_64&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;then
      &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;XLDFLAGS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-isysroot &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CROSS_TOP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/SDKs/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CROSS_SDK&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -miphoneos-version-min=7.0 -L&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIBPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -arch &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else
      &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;XLDFLAGS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-isysroot &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CROSS_TOP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/SDKs/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CROSS_SDK&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -miphoneos-version-min=7.0 -L&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIBPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -arch &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;fi

  &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;OUTPATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;BUILDPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/librtmp-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PLATFORM&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SDKVERSION&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.sdk&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;OUTPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;LOG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;OUTPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/build-librtmp.log&quot;&lt;/span&gt;

  make &lt;span class=&quot;nv&quot;&gt;SYS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;darwin &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOG&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; 2&amp;gt;&amp;amp;1  
  make &lt;span class=&quot;nv&quot;&gt;SYS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;darwin &lt;span class=&quot;nv&quot;&gt;prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;OUTPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOG&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; 2&amp;gt;&amp;amp;1
  make clean &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOG&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; 2&amp;gt;&amp;amp;1

  LIBRTMP_REPO+&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;OUTPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/lib/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIBRTMP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;done

&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Build universal library...&quot;&lt;/span&gt;  
lipo &lt;span class=&quot;nt&quot;&gt;-create&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIBRTMP_REPO&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-output&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIBPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIBRTMP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;INCLUDEPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-R&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;BUILDPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/librtmp-iPhoneSimulator&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SDKVERSION&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-i386&lt;/span&gt;.sdk/include/ &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;INCLUDEPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Building done.&quot;&lt;/span&gt;  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Cleaning up...&quot;&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-rf&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SRCPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/rtmpdump  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Done.&quot;&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¿å­˜å¹¶ä¸”æ‰§è¡Œ&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./build.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœæŠ¥æƒé™é”™è¯¯ï¼Œåˆ™å…ˆèµ‹äºˆæƒé™&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;chmod +x build.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/28.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€ç»ˆå¯ä»¥å¾—åˆ°librtmp.aä»¥åŠincludeæ–‡ä»¶&lt;/p&gt;

&lt;h3 id=&quot;äºŒå¯¼å…¥åº“&quot;&gt;äºŒã€å¯¼å…¥åº“&lt;/h3&gt;

&lt;p&gt;1ã€å°†includeæ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶å°±åƒæ­£å¸¸æ–‡ä»¶ä¸€æ ·å¯¼å…¥ï¼Œå¦‚ä¸‹å›¾&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/29.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/30.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;2ã€libæ–‡ä»¶å¤¹é‡Œçš„é™æ€åº“æ–‡ä»¶åˆ™è¦è¿›è¡Œé“¾æ¥&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/31.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ³¨æ„é™¤äº†ä¸‰ä¸ªç”Ÿæˆçš„é™æ€åº“æ–‡ä»¶ï¼Œè¿˜è¦å¯¼å…¥ä¸€ä¸ªiOSçš„åŠ¨æ€åº“ï¼Œlibz.tbdï¼Œå¦åˆ™è¿è¡Œä¼šæŠ¥é”™ï¼Œå¯¼å…¥ä¹‹åé”™è¯¯æ¶ˆå¤±ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/32.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;ä¸‰æ¨æµ&quot;&gt;ä¸‰ã€æ¨æµ&lt;/h3&gt;

&lt;p&gt;å› ä¸ºlibrtmpç”¨çš„æ˜¯Cè¯­è¨€ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒç”¨ï¼Œæˆ‘ç”¨OCå°è£…äº†ä¸€ä¸‹ä¸€ä¸ªç±»RTMPPuserã€‚ç”¨æ¥æ¨æµçš„ä»£ç æ˜¯&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;n&quot;&gt;RTMPPusher&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pusher&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RTMPPusher&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;BOOL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;success&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pusher&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;connectWithURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;rtmp://192.168.0.16:1935/zbcs/room&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;success&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;htmlFile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSBundle&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mainBundle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pathForResource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;demo&quot;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ofType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;flv&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;video&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dataWithContentsOfFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;htmlFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pusher&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;pushFullVideoData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;video&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;chunkSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5120&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pusher&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;closeRTMP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;1å»ºç«‹è¿æ¥&quot;&gt;1ã€å»ºç«‹è¿æ¥&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BOOL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;connectWithURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;@synchronized&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_rtmp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;newRTMP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strUrl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cStringUsingEncoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSASCIIStringEncoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RTMP_SetupURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_rtmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;RTMP_EnableWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_rtmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RTMP_Connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_rtmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RTMP_ConnectStream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_rtmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;_connected&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RTMP_IsConnected&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_rtmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;2åˆ‡ç‰‡&quot;&gt;2ã€åˆ‡ç‰‡&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pushFullVideoData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;fullVideo&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;chunkSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUInteger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSUInteger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fullVideo&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSUInteger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chunkSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5120&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSUInteger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// å°†æ•´è§†é¢‘åˆ‡ç‰‡åæ¨é€&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSUInteger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thisChunkSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chunkSize&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chunkSize&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chunk&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dataWithBytesNoCopy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fullVideo&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt;
                                             &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thisChunkSize&lt;/span&gt;
                                       &lt;span class=&quot;nl&quot;&gt;freeWhenDone:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thisChunkSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chunk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;3å†™å…¥æ¨æµ&quot;&gt;3ã€å†™å…¥æ¨æµ&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUInteger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;@synchronized&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_connected&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;sent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RTMP_Write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_rtmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä»¥ä¸Šä»£ç å¯ä»¥åœ¨&lt;a href=&quot;https://github.com/helloted/iOS_Demo/tree/master/RTMPDemo&quot;&gt;æ¨æµDemo&lt;/a&gt;ä¸‹è½½&lt;/p&gt;</content><author><name>Ted</name></author><category term="ç›´æ’­" /><summary type="html">ä¸€ã€ç¼–è¯‘libåº“</summary></entry><entry><title type="html">Macä¸Šæ­å»ºç›´æ’­æœåŠ¡å™¨</title><link href="http://www.helloted.com/%E7%9B%B4%E6%92%AD/2018/05/01/vlclive/" rel="alternate" type="text/html" title="Macä¸Šæ­å»ºç›´æ’­æœåŠ¡å™¨" /><published>2018-05-01T20:00:00+08:00</published><updated>2018-05-01T20:00:00+08:00</updated><id>http://www.helloted.com/%E7%9B%B4%E6%92%AD/2018/05/01/vlclive</id><content type="html" xml:base="http://www.helloted.com/%E7%9B%B4%E6%92%AD/2018/05/01/vlclive/">&lt;h4 id=&quot;1å®‰è£…nginx&quot;&gt;1ã€å®‰è£…Nginx&lt;/h4&gt;

&lt;p&gt;é€šè¿‡homebrewæ¥å®‰è£…æ”¯æŒrtmpåè®®æ¨¡å—çš„nginx&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;brew install nginx-full --with-rtmp-module
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹å®‰è£…ä½ç½®&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;brew info nginx-full
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/22.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€šè¿‡æµè§ˆå™¨è®¿é—®&lt;a href=&quot;http://localhost:8080&quot;&gt;http://localhost:8080&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/23.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨nginx.confé‡Œé…ç½®&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rtmp {
    server {
        listen 1935;
        application zbcs {
            live on;
            record off;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é‡å¯&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nginx -s reload
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;2å®‰è£…ffmpegæ¥æ¨æµæœ¬åœ°è§†é¢‘&quot;&gt;2ã€å®‰è£…ffmpegæ¥æ¨æµæœ¬åœ°è§†é¢‘&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;brew install ffmpeg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ¨æµå‘½ä»¤ä¸º&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ffmpeg -re -i /Users/imac/Documents/demo.mp4 -vcodec copy -f flv rtmp://127.0.0.1:1935/zbcs/room
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ffmpeg -re -i ä½ çš„è§†é¢‘æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ -vcodec copy -f flv rtmp://localhost:1935/nginxé…ç½®çš„applicationåç§°/room
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿™å°±å¼€å§‹æ¨æµäº†&lt;/p&gt;

&lt;h4 id=&quot;3vlcç›´æ’­&quot;&gt;3ã€VLCç›´æ’­&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;macç«¯&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä¸‹è½½vlcæ’­æ”¾å™¨ï¼Œåœ¨File-&amp;gt;open networkè¾“å…¥&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rtmp://127.0.0.1:1935/zbcs/room
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/24.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;iPhone&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä¸‹è½½VLCæ’­æ”¾å™¨ï¼ŒåŒä¸€å±€åŸŸç½‘ï¼Œæ‰“å¼€ç½‘ç»œæµï¼Œè¾“å…¥&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rtmp://ç”µè„‘çš„æœ¬åœ°IP:1935/zbcs/room
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/26.jpg&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;4æ¨æµæ¡Œé¢æˆ–è€…æ‘„åƒå¤´ç›´æ’­&quot;&gt;4ã€æ¨æµæ¡Œé¢æˆ–è€…æ‘„åƒå¤´ç›´æ’­&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ffmpeg -f avfoundation -list_devices true -i &quot;&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/25.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°åœ¨è§†é¢‘è®¾å¤‡ï¼š&lt;/p&gt;

&lt;p&gt;0ï¼šæ‘„åƒå¤´&lt;/p&gt;

&lt;p&gt;1ï¼šæ¡Œé¢æ•è·&lt;/p&gt;

&lt;p&gt;éŸ³é¢‘è®¾å¤‡ï¼š&lt;/p&gt;

&lt;p&gt;0ï¼šéº¦å…‹é£&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥å¦‚æœè¦ç›´æ’­æ‘„åƒå¤´&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ffmpeg -f avfoundation -i &quot;0&quot; -vcodec libx264  -f flv rtmp://localhost:1935/zbcs/room
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åŠ ä¸Šå£°éŸ³&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ffmpeg -f avfoundation -i &quot;0:0&quot; -vcodec libx264  -acodec libmp3lame -ar 44100 -ac 1 -f flv rtmp://localhost:1935/zbcs/room
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿˜å¯ä»¥è®¾ç½®é¢‘ç‡å’Œåˆ†è¾¨ç‡&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// è®¾ç½®å¸§ç‡ä¸º30å¸§ï¼Œå›¾åƒå¤§å°ä¸º320x240
ffmpeg -f avfoundation -framerate 30 -video_size 320x240 -i &quot;0&quot; -vcodec libx264 -f flv rtmp://localhost:1935/zbcs/room
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœè¦å®ç°ç”µè„‘å±å¹•å’Œæ‘„åƒå¤´ä¸€èµ·ç›´æ’­&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ffmpeg -f avfoundation  -framerate 30 -i &quot;1:0&quot; -f avfoundation -framerate 30 -video_size 320x240 -i &quot;0&quot; -vcodec libx264 -filter_complex 'overlay=main_w-overlay_w-10:main_h-overlay_h-10'  -acodec libmp3lame -ar 44100 -ac 1 -f flv rtmp://localhost:1935/zbcs/room
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Ted</name></author><category term="ç›´æ’­" /><summary type="html">1ã€å®‰è£…Nginx</summary></entry><entry><title type="html">UITableViewå®è·µ(ä¸€):å®ç°åŸç†</title><link href="http://www.helloted.com/ios/2018/04/25/tableView_1/" rel="alternate" type="text/html" title="UITableViewå®è·µ(ä¸€):å®ç°åŸç†" /><published>2018-04-25T20:00:00+08:00</published><updated>2018-04-25T20:00:00+08:00</updated><id>http://www.helloted.com/ios/2018/04/25/tableView_1</id><content type="html" xml:base="http://www.helloted.com/ios/2018/04/25/tableView_1/">&lt;h3 id=&quot;ä¸€ç»¼è¿°&quot;&gt;ä¸€ã€ç»¼è¿°&lt;/h3&gt;

&lt;p&gt;UITableViewåº”è¯¥æ˜¯iOSä¸­æœ€ç»å…¸ä¹Ÿæ˜¯æœ€å¸¸è§çš„ä¸€ä¸ªæ§ä»¶äº†ã€‚ä½¿ç”¨å¾ˆæ™®é&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;UITableView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tableView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableViewStyleGrouped&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;   
&lt;span class=&quot;n&quot;&gt;tableView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delegate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;tableView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dataSource&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tableView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;registerClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableViewCell&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;forCellReuseIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;MyCellReuseIdentifier&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;view&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addSubview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tableView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#pragma mark - UITableViewDelegate
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// è¡Œé«˜&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tableView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tableView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;heightForRowAtIndexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSIndexPath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;indexPath&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#pragma mark - UITableViewDataSource
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Cellå¤ç”¨&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableViewCell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tableView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tableView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cellForRowAtIndexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSIndexPath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;indexPath&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UITableViewCell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tableView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dequeueReusableCellWithIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;MyCellReuseIdentifier&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// è¡Œæ•°&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSInteger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tableView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tableView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;numberOfRowsInSection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSInteger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;section&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dataArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;chameleoné¡¹ç›®&quot;&gt;&lt;a href=&quot;https://github.com/BigZaphod/Chameleon&quot;&gt;Chameleon&lt;/a&gt;é¡¹ç›®&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;If youâ€™re an iOS developer, youâ€™re already familiar with UIKit, the framework used to create apps for the iPhone, iPod and iPad. Chameleon is a drop in replacement for UIKit that runs on Mac OS X. In many cases, your iOS code doesnâ€™t need to change at all in order to run on a Mac.&lt;/p&gt;

  &lt;p&gt;This new framework is a clean room implementation of the work done by Apple for iOS. The only thing Chameleon has in common with UIKit are the public class and method names. The code is based on Appleâ€™s documentation and does not use any private APIs or other techniques disallowed by the Mac App Store.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æˆ‘ä»¬çŸ¥é“åœ¨iOSä¸Šå¼€å‘çš„è§†å›¾ä½¿ç”¨UIKitï¼ŒMac OSåˆ™æ²¡æœ‰ã€‚Chameleoné¡¹ç›®å°±æ˜¯å°†UIKitçš„ä»£ç ä¹Ÿå¯ä»¥è¿è¡Œåœ¨macOSä¸Šã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Chameleoné¡¹ç›®çš„æºç æ¥ä¸€æ¢ç©¶ç«Ÿï¼ŒUITableViewæ˜¯å¦‚ä½•å®ç°çš„ã€‚&lt;/p&gt;

&lt;h3 id=&quot;äºŒåˆå§‹åŒ–&quot;&gt;äºŒã€åˆå§‹åŒ–&lt;/h3&gt;

&lt;h4 id=&quot;1init&quot;&gt;1ã€init&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;initWithFrame:(CGRect)frame style:(UITableViewStyle)theStyle&lt;/code&gt;æ˜¯æœ€å¸¸ç”¨çš„åˆå§‹åŒ–æ–¹å¼ï¼Œé‚£ä¹ˆChameleoné¡¹ç›®æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;frame&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableViewStyle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;theStyle&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_style&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;theStyle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
       &lt;span class=&quot;c1&quot;&gt;// å·²ç”ŸæˆCellçš„ç¼“å­˜&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_cachedCells&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSMutableDictionary&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
       &lt;span class=&quot;c1&quot;&gt;// Secitonsçš„ç¼“å­˜&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_sections&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSMutableArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
       &lt;span class=&quot;c1&quot;&gt;// å¤ç”¨çš„Cells&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_reusableCells&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSMutableSet&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

      	&lt;span class=&quot;c1&quot;&gt;// ä¸€äº›åŸºæœ¬å±æ€§çš„åˆå§‹åŒ–&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;separatorColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIColor&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;colorWithRed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;88&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;green&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;88&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;blue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;88&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;separatorStyle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UITableViewCellSeparatorStyleSingleLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;showsHorizontalScrollIndicator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;allowsSelection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;allowsSelectionDuringEditing&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sectionHeaderHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sectionFooterHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alwaysBounceVertical&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_style&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UITableViewStylePlain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIColor&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;whiteColor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
      	&lt;span class=&quot;c1&quot;&gt;// setNeedsLayout&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_setNeedsReload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_setNeedsReload&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_needsReload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setNeedsLayout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åˆå§‹åŒ–å¤§æ¦‚åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç”¨æ¥è£…è½½å®ä¾‹çš„å®¹å™¨åˆå§‹åŒ–&lt;/li&gt;
  &lt;li&gt;åŸºæœ¬å±æ€§çš„é»˜è®¤å€¼èµ‹å€¼&lt;/li&gt;
  &lt;li&gt;æ ‡è®°éœ€è¦&lt;code class=&quot;highlighter-rouge&quot;&gt;setNeedsLayout&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä»¬çŸ¥é“ï¼ŒiOSçš„äº¤äº’æµç¨‹æ˜¯è¿™æ ·çš„&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_3/15.jpg&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥å°±æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;layoutSubviews&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;2layoutsubviews&quot;&gt;2ã€layoutSubviews&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layoutSubviews&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_backgroundView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_reloadDataIfNeeded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_layoutTableView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;layoutSubviews&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/20.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;reloadData&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reloadData&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// clear the caches and remove the cells since everything is going to change&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_cachedCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;allValues&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;makeObjectsPerformSelector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;@selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;removeFromSuperview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_reusableCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;makeObjectsPerformSelector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;@selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;removeFromSuperview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_reusableCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;removeAllObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_cachedCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;removeAllObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// clear prior selection&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_selectedRow&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_highlightedRow&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// trigger the section cache to be repopulated&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_updateSectionsCache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_setContentSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;_needsReload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å› ä¸ºéœ€è¦é‡æ–°åŠ è½½æ•°æ®ï¼Œæ‰€ä»¥å°†ç¼“å­˜ä»¥åŠå¤ç”¨çš„Celléƒ½æ¸…ç©ºæ‰ï¼ŒSectionsCacheä¹Ÿæ›´æ–°æ‰&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;layoutTableView&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_layoutTableView&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// lays out headers and rows that are visible at the time. this should also do cell&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// dequeuing and keep a list of all existing cells that are visible and those&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// that exist but are not visible and are reusable&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// if there's no section cache, no rows will be laid out but the header/footer will (if any).&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGSize&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;boundsSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contentOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;visibleBounds&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGRectMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boundsSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boundsSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tableHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_tableHeaderView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tableHeaderFrame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_tableHeaderView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;tableHeaderFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;origin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGPointZero&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;tableHeaderFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;boundsSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_tableHeaderView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tableHeaderFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;tableHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tableHeaderFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// layout sections and rows&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSMutableDictionary&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;availableCells&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_cachedCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mutableCopy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSInteger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numberOfSections&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_sections&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_cachedCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;removeAllObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSInteger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numberOfSections&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sectionRect&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;rectForSection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;tableHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sectionRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRectIntersectsRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sectionRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;visibleBounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;headerRect&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;rectForHeaderInSection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;footerRect&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;rectForFooterInSection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;UITableViewSection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sectionRecord&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_sections&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSInteger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numberOfRows&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sectionRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numberOfRows&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sectionRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headerView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;sectionRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headerView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;headerRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sectionRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;footerView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;sectionRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;footerView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;footerRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            
            &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSInteger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;row&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;row&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numberOfRows&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;row&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;NSIndexPath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexPath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSIndexPath&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;indexPathForRow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;inSection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rowRect&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;rectForRowAtIndexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRectIntersectsRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rowRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;visibleBounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rowRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;UITableViewCell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;availableCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectForKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dataSource&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;tableView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cellForRowAtIndexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_cachedCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;availableCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;removeObjectForKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;highlighted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_highlightedRow&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqual&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;selected&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_selectedRow&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqual&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rowRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundColor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_setSeparatorStyle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_separatorStyle&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_separatorColor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addSubview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// remove old cells, but save off any that might be reusable&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableViewCell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;availableCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;allValues&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reuseIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_reusableCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;removeFromSuperview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// non-reusable cells should end up dealloced after at this point, but reusable ones live on in _reusableCells.&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// now make sure that all available (but unused) reusable cells aren't on screen in the visible area.&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// this is done becaue when resizing a table view by shrinking it's height in an animation, it looks better. The reason is that&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// when an animation happens, it sets the frame to the new (shorter) size and thus recalcuates which cells should be visible.&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// If it removed all non-visible cells, then the cells on the bottom of the table view would disappear immediately but before&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// the frame of the table view has actually animated down to the new, shorter size. So the animation is jumpy/ugly because&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// the cells suddenly disappear instead of seemingly animating down and out of view like they should. This tries to leave them&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// on screen as long as possible, but only if they don't get in the way.&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSArray&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;allCachedCells&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_cachedCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;allValues&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableViewCell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_reusableCells&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRectIntersectsRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;visibleBounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;allCachedCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;containsObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;removeFromSuperview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_tableFooterView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tableFooterFrame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_tableFooterView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;tableFooterFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;origin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGPointMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tableHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;tableFooterFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;boundsSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_tableFooterView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tableFooterFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸€æ­¥æ“ä½œä¸»è¦æ˜¯å°†å·²ç»åˆå§‹åŒ–çš„Cellsé‡æ–°å¸ƒå±€ï¼Œä»¥åŠå…¶ä»–å¸ƒå±€å¦‚HeadViewï¼ŒFootViewçš„è®¾ç½®&lt;/p&gt;

&lt;h3 id=&quot;ä¸‰cellå¤ç”¨&quot;&gt;ä¸‰ã€Cellå¤ç”¨&lt;/h3&gt;

&lt;p&gt;cellåœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šç»‘å®šä¸€ä¸ªIdentifierç”¨ä»¥ä»¥åå¤ç”¨&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;initWithStyle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableViewCellStyle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;style&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;reuseIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;reuseIdentifier&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRectMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;320&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_UITableViewDefaultRowHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_style&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_reuseIdentifier&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reuseIdentifier&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;copy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¦‚ä¸Šæ–‡ï¼Œåœ¨UITableViewåˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šåˆå§‹åŒ–ä¸€ä¸ªç©ºçš„é›†åˆç”¨æ¥è£…è½½å¯å¤ç”¨çš„Cellã€‚è¿™æ˜¯ä¸€ä¸ªå¯å˜çš„é›†åˆ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Objc&quot;&gt;_reusableCells = [[NSMutableSet alloc] init];
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨UITableViewé‡è½½æ•°æ®&lt;code class=&quot;highlighter-rouge&quot;&gt;reloadData&lt;/code&gt;æ—¶ï¼Œä¼šå°†é‡Œé¢çš„cellæ¸…ç©º&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_reusableCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;makeObjectsPerformSelector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;@selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;removeFromSuperview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_reusableCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;removeAllObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨TableViewæ»‘åŠ¨æˆ–è€…åšäº†å…¶ä»–æ›´æ–°å¸ƒå±€&lt;code class=&quot;highlighter-rouge&quot;&gt;layoutTableView&lt;/code&gt;ï¼Œå°†ç»‘å®šäº†Identifierçš„cellè£…å…¥é›†åˆä»¥ä¾¿å¤ç”¨&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;c1&quot;&gt;// remove old cells, but save off any that might be reusable&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableViewCell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;availableCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;allValues&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reuseIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_reusableCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;removeFromSuperview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸‹é¢æ˜¯UITableviewæ•°æ®æºåè®®çš„å¤ç”¨ä»£ç &lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableViewCell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tableView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tableView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cellForRowAtIndexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSIndexPath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;indexPath&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UITableViewCell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tableView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dequeueReusableCellWithIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;MyCellReuseIdentifier&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ ¹æ®Identifierå°†cellä»é›†åˆä¸­å–å‡º&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableViewCell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;dequeueReusableCellWithIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;identifier&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableViewCell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_reusableCells&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reuseIdentifier&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;UITableViewCell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strongCell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            
            &lt;span class=&quot;c1&quot;&gt;// the above strongCell reference seems totally unnecessary, but without it ARC apparently&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// ends up releasing the cell when it's removed on this line even though we're referencing it&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// later in this method by way of the cell variable. I do not like this.&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_reusableCells&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;removeObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strongCell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;cellå¤ç”¨çš„ä¸‰ä¸ªå®¹å™¨&quot;&gt;Cellå¤ç”¨çš„ä¸‰ä¸ªå®¹å™¨&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;NSMutableDictionary&lt;/code&gt; ç±»å‹ &lt;strong&gt;_cachedCells&lt;/strong&gt;ï¼šç”¨æ¥å­˜å‚¨å½“å‰å±å¹•ä¸Šæ‰€æœ‰ Cell ä¸å…¶å¯¹åº”çš„ indexPathã€‚ä»¥é”®å€¼å¯¹çš„å…³ç³»è¿›è¡Œå­˜å‚¨ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;NSMutableDictionary&lt;/code&gt; ç±»å‹ &lt;strong&gt;availableCells&lt;/strong&gt;ï¼šå½“åˆ—è¡¨å‘ç”Ÿæ»‘åŠ¨çš„æ—¶å€™ï¼Œéƒ¨åˆ† Cell ä»å±å¹•ç§»å‡ºï¼Œè¿™ä¸ªå®¹å™¨ä¼šå¯¹ &lt;code class=&quot;highlighter-rouge&quot;&gt;_cachedCells&lt;/code&gt; è¿›è¡Œæ‹·è´ï¼Œç„¶åå°†å±å¹•ä¸Šæ­¤æ—¶çš„ Cell å…¨éƒ¨å»é™¤ã€‚å³æœ€ç»ˆå–å‡ºæ‰€æœ‰é€€å‡ºå±å¹•çš„ Cellã€‚&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;NSMutableSet&lt;/code&gt; ç±»å‹ &lt;strong&gt;_reusableCells&lt;/strong&gt;ï¼šç”¨æ¥æ”¶é›†æ›¾ç»å‡ºç°è¿‡æ­¤æ—¶æœªå‡ºç°åœ¨å±å¹•ä¸Šçš„ Cellã€‚å½“å†å‡ºæ»‘å…¥ä¸»å±å¹•æ—¶ï¼Œåˆ™ç›´æ¥ä½¿ç”¨å…¶ä¸­çš„å¯¹è±¡æ ¹æ® &lt;code class=&quot;highlighter-rouge&quot;&gt;CGRectIntersectsRect&lt;/code&gt; Rect ç¢°æ’è¯•éªŒè¿›è¡Œå¤ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/21.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å½“åˆ°çŠ¶æ€ â‘¡ çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç° &lt;code class=&quot;highlighter-rouge&quot;&gt;_reusableCells&lt;/code&gt; å®¹å™¨ä¸­ï¼Œå·²ç»å‡ºç°äº†çŠ¶æ€ â‘  ä¸­å·²ç»é€€å‡ºå±å¹•çš„ Cell 0ã€‚è€Œå½“æˆ‘ä»¬é‡æ–°å°† Cell 0 æ»‘å…¥ç•Œé¢çš„æ—¶å€™ï¼Œåœ¨ç³»ç»Ÿ &lt;code class=&quot;highlighter-rouge&quot;&gt;addView&lt;/code&gt; æ¸²æŸ“é˜¶æ®µï¼Œä¼šç›´æ¥å°† &lt;code class=&quot;highlighter-rouge&quot;&gt;_reusableCells&lt;/code&gt; ä¸­çš„ Cell 0 ç«‹å³å–å‡ºè¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œä»£æ›¿åˆ›å»ºæ–°çš„å®ä¾‹å†è¿›è¡Œæ¸²æŸ“ï¼Œç®€åŒ–äº†æ—¶é—´ä¸æ€§èƒ½ä¸Šçš„å¼€é”€ã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;

&lt;p&gt;https://github.com/BigZaphod/Chameleon&lt;/p&gt;

&lt;p&gt;http://www.desgard.com/TableView-Reuse/&lt;/p&gt;</content><author><name>Ted</name></author><category term="iOS" /><summary type="html">ä¸€ã€ç»¼è¿°</summary></entry><entry><title type="html">Objective-Cå¯¹è±¡å¼•ç”¨</title><link href="http://www.helloted.com/ios/2018/04/14/reference/" rel="alternate" type="text/html" title="Objective-Cå¯¹è±¡å¼•ç”¨" /><published>2018-04-14T20:00:00+08:00</published><updated>2018-04-14T20:00:00+08:00</updated><id>http://www.helloted.com/ios/2018/04/14/reference</id><content type="html" xml:base="http://www.helloted.com/ios/2018/04/14/reference/">&lt;h3 id=&quot;ä¸€å¼•ç”¨&quot;&gt;ä¸€ã€å¼•ç”¨&lt;/h3&gt;

&lt;p&gt;å¼•ç”¨æ˜¯iOSå†…å­˜ç®¡ç†ä¸­çš„é‡è¦çŸ¥è¯†ç‚¹ï¼Œæ€»æ‰€å‘¨çŸ¥ï¼ŒiOSå¯¹è±¡çš„å†…å­˜ç®¡ç†æ˜¯ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥è¡¨ç¤ºçš„ã€‚ä¸€ä¸ªå¯¹è±¡åªæœ‰åœ¨å®ƒçš„æ‰€æœ‰å¼ºå¼•ç”¨éƒ½è¢«é‡Šæ”¾åæ‰èƒ½è¢«å›æ”¶ã€‚å› æ­¤ï¼Œä¸€ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå–å†³äºå…¶å¼ºå¼•ç”¨çš„æ‰€æœ‰è€…ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ç§è¡Œä¸ºå¯èƒ½å¹¶ä¸ç†æƒ³ã€‚æ‚¨å¯èƒ½æƒ³è¦å¼•ç”¨ä¸€ä¸ªå¯¹è±¡è€Œä¸å¦¨ç¢å¯¹è±¡æœ¬èº«çš„å›æ”¶ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæ‚¨å¯ä»¥è·å–ä¸€ä¸ªâ€œå¼±â€å¼•ç”¨ã€‚å¼±å¼•ç”¨æ˜¯é€šè¿‡å­˜å‚¨ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆåˆ›å»ºçš„ï¼Œè€Œä¸æ˜¯ä¿ç•™å¯¹è±¡ã€‚&lt;/p&gt;

&lt;p&gt;å¼ºå¼•ç”¨(æŒæœ‰å¯¹è±¡Retain)ï¼šå½“å‰å¯¹è±¡è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨æ—¶ï¼Œä¼šæ‰§è¡Œretainæ“ä½œï¼Œå¼•ç”¨è®¡æ•°å™¨+1ã€‚æ‰€ä»¥åªè¦æœ‰ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œå½“å‰å¯¹è±¡å°±ä¸å¯èƒ½è¢«é‡Šæ”¾ï¼ŒRootViewControllerã€NavgationControllerã€TabbarContrlleréƒ½ä¼šå¯¹ViewCoontrllerè¿›è¡Œå¼ºå¼•ç”¨ï¼ŒaddSubViewä¼šå¯¼è‡´å¯¹å­Viewçš„å¼ºå¼•ç”¨ï¼Œå±æ€§æˆå‘˜å˜é‡å¦‚æœä¿®é¥°ç¬¦æ˜¯Strongä¹Ÿæ˜¯å¼ºå¼•ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;å¼±å¼•ç”¨ï¼šä¸ä¼šä¿®æ”¹å¼•ç”¨è®¡æ•°ï¼Œä¸è®ºæœ‰å¤šå°‘å¼±å¼•ç”¨ï¼Œè¯¥é‡Šæ”¾å°±é‡Šæ”¾ï¼Œè€Œä¸”weakæŒ‡é’ˆåœ¨è¢«é‡Šæ”¾çš„æ—¶å€™è¿˜ä¼šè¢«ç½®ä¸ºnilï¼Œé˜²æ­¢é‡æŒ‡é’ˆçš„å‡ºç°&lt;/p&gt;

&lt;h4 id=&quot;weak-å¼•ç”¨åŸç†&quot;&gt;weak å¼•ç”¨åŸç†ï¼š&lt;/h4&gt;

&lt;p&gt;1ã€åˆå§‹åŒ–æ—¶ï¼šruntimeä¼šè°ƒç”¨objc_initWeakå‡½æ•°ï¼Œåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„weakæŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„åœ°å€ã€‚&lt;/p&gt;

&lt;p&gt;2ã€æ·»åŠ å¼•ç”¨æ—¶ï¼šobjc_initWeakå‡½æ•°ä¼šè°ƒç”¨ objc_storeWeak() å‡½æ•°ï¼Œ objc_storeWeak() çš„ä½œç”¨æ˜¯æ›´æ–°æŒ‡é’ˆæŒ‡å‘ï¼Œåˆ›å»ºå¯¹åº”çš„å¼±å¼•ç”¨è¡¨ã€‚&lt;/p&gt;

&lt;p&gt;3ã€é‡Šæ”¾æ—¶ï¼Œè°ƒç”¨clearDeallocatingå‡½æ•°ã€‚clearDeallocatingå‡½æ•°é¦–å…ˆæ ¹æ®å¯¹è±¡åœ°å€è·å–æ‰€æœ‰weakæŒ‡é’ˆåœ°å€çš„æ•°ç»„ï¼Œç„¶åéå†è¿™ä¸ªæ•°ç»„æŠŠå…¶ä¸­çš„æ•°æ®è®¾ä¸ºnilï¼Œæœ€åæŠŠè¿™ä¸ªentryä»weakè¡¨ä¸­åˆ é™¤ï¼Œæœ€åæ¸…ç†å¯¹è±¡çš„è®°å½•ã€‚&lt;/p&gt;

&lt;h3 id=&quot;äºŒå¾ªç¯å¼•ç”¨&quot;&gt;äºŒã€å¾ªç¯å¼•ç”¨&lt;/h3&gt;

&lt;p&gt;å¯¹è±¡ A å’Œå¯¹è±¡ Bï¼Œç›¸äº’å¼•ç”¨äº†å¯¹æ–¹ä½œä¸ºè‡ªå·±çš„æˆå‘˜å˜é‡ï¼Œåªæœ‰å½“è‡ªå·±é”€æ¯æ—¶ï¼Œæ‰ä¼šå°†æˆå‘˜å˜é‡çš„å¼•ç”¨è®¡æ•°å‡ 1ã€‚å› ä¸ºå¯¹è±¡ A çš„é”€æ¯ä¾èµ–äºå¯¹è±¡ B é”€æ¯ï¼Œè€Œå¯¹è±¡ B çš„é”€æ¯ä¸ä¾èµ–äºå¯¹è±¡ A çš„é”€æ¯ï¼Œè¿™æ ·å°±é€ æˆäº†æˆ‘ä»¬ç§°ä¹‹ä¸ºå¾ªç¯å¼•ç”¨ï¼ˆReference Cycleï¼‰ã€‚å¾ªç¯å¼•ç”¨æ¯”è¾ƒå®¹æ˜“å‡ºç°åœ¨Blockã€Timerå¼•ç”¨ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/17.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰“ç ´å¾ªç¯å¼•ç”¨å¾ˆç®€å•ï¼Œå°†å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆæ”¹ä¸ºå¼±å¼•ç”¨&lt;/p&gt;

&lt;h4 id=&quot;ä¸‰nstimerå¼•èµ·çš„å¾ªç¯å¼•ç”¨&quot;&gt;ä¸‰ã€NSTimerå¼•èµ·çš„å¾ªç¯å¼•ç”¨&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DetailViewController&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nonatomic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;weak&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSTimer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DetailViewController&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IBAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fireButtonPressed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;sender&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_timer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSTimer&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;scheduledTimerWithTimeInterval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;
                                              &lt;span class=&quot;nf&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;
                                            &lt;span class=&quot;nl&quot;&gt;selector:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;@selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timerFire&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                            &lt;span class=&quot;nl&quot;&gt;userInfo:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;
                                             &lt;span class=&quot;nl&quot;&gt;repeats:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_timer&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fire&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;timerFire&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;userinfo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;Fire&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å½“æˆ‘ä»¬ä»è¿™ä¸ªç•Œé¢è·³è½¬åˆ°å…¶ä»–ç•Œé¢çš„æ—¶å€™å´å‘ç°ï¼šæ§åˆ¶å°è¿˜åœ¨æºæºä¸æ–­çš„è¾“å‡ºç€ Fire ã€‚çœ‹æ¥ &lt;code class=&quot;highlighter-rouge&quot;&gt;Timer&lt;/code&gt; å¹¶æ²¡æœ‰åœæ­¢ã€‚ViewControllerçš„deallocä¹Ÿæœªè¢«è°ƒç”¨ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºä»€ä¹ˆViewControllerå¯¹timeræ˜¯å¼±å¼•ç”¨ï¼Œè¿˜æ˜¯ä¸è¡Œï¼Ÿ&lt;/p&gt;

&lt;p&gt;åŸå› æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;Timer&lt;/code&gt; æ·»åŠ åˆ° &lt;code class=&quot;highlighter-rouge&quot;&gt;Runloop&lt;/code&gt; çš„æ—¶å€™ï¼Œä¼šè¢« &lt;code class=&quot;highlighter-rouge&quot;&gt;Runloop&lt;/code&gt; å¼ºå¼•ç”¨ï¼ŒTimerå¯¹Selfè¿›è¡Œå¼ºå¼•ç”¨ï¼Œå¯¼è‡´ViewControllerå¾—ä¸åˆ°é‡Šæ”¾ã€‚&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆæ¢æˆweakSelfå‘¢ï¼Ÿå°±æ˜¯æˆ‘ä»¬åœ¨blockä¸­å¸¸ç”¨çš„é‚£ç§ã€‚&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;__weak&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;weakSelf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;_timer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSTimer&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;scheduledTimerWithTimeInterval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;
                                          &lt;span class=&quot;nf&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;weakSelf&lt;/span&gt;
                                        &lt;span class=&quot;n&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;@selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timerFire&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                        &lt;span class=&quot;n&quot;&gt;userInfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;
                                         &lt;span class=&quot;n&quot;&gt;repeats&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å®é™…è¿è¡Œå‘ç°ï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œè¯´æ˜targetå°±æ˜¯å¼ºå¼•ç”¨ã€‚&lt;/p&gt;

&lt;h4 id=&quot;è§£å†³æ–¹æ¡ˆ&quot;&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;

&lt;p&gt;ä½¿ç”¨ä¸€ä¸ªä¸­é—´targetç»™timerï¼Œä¸è®©timerç›´æ¥å¼ºå¼•ç”¨VCã€‚&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;HTWeakTimer&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fire&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSTimer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;timer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;performSelector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;selector&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;withObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;invalidate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSTimer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;scheduledTimerWithTimeInterval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSTimeInterval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;interval&lt;/span&gt;
                                      &lt;span class=&quot;nf&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;aTarget&lt;/span&gt;
                                    &lt;span class=&quot;nf&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SEL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;aSelector&lt;/span&gt;
                                    &lt;span class=&quot;nf&quot;&gt;userInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;userInfo&lt;/span&gt;
                                     &lt;span class=&quot;nf&quot;&gt;repeats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BOOL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;repeats&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;HTWeakTimer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timerTarget&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HTWeakTimer&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;timerTarget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aTarget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;timerTarget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;selector&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aSelector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;timerTarget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSTimer&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;scheduledTimerWithTimeInterval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;interval&lt;/span&gt;
                                                         &lt;span class=&quot;nf&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timerTarget&lt;/span&gt;
                                                       &lt;span class=&quot;nl&quot;&gt;selector:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;@selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fire&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                                       &lt;span class=&quot;nl&quot;&gt;userInfo:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userInfo&lt;/span&gt;
                                                        &lt;span class=&quot;nl&quot;&gt;repeats:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;repeats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timerTarget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å››å¦‚ä½•objc_setassociatedobjectå…³è”weakå±æ€§&quot;&gt;å››ã€å¦‚ä½•objc_setAssociatedObjectå…³è”weakå±æ€§&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;OBJC_ASSOCIATION_ASSIGN&lt;/code&gt; ä¸ä¼šåœ¨å±æ€§æ¸…ç©ºåå°†å¼•ç”¨æŒ‡é’ˆæ¸…ç©ºï¼Œè¿™ä¼šé€ æˆé‡æŒ‡é’ˆï¼Œæ‰€ä»¥æ˜¯ç”±é£é™©å»è®¿é—®ä¸€ä¸ªå·²ç»è¢«æ¸…é™¤çš„å¯¹è±¡çš„ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨å¦å¤–çš„ä¸€ç§æ–¹æ³•æ¥å…³è”ä¸€ä¸ªweakå±æ€§ï¼Œé‚£å°±æ˜¯å¼ºå…³è”ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åè®©è¿™ä¸ªå¯¹è±¡æ¥å¼±å¼•ç”¨è¿™ä¸ªå±æ€§ã€‚&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;WeakObjectContainer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NSObject&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nonatomic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;readonly&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;weak&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;WeakObjectContainer&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;instancetype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;_object&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æŠŠWeakObjectContainerå¯¹è±¡ç”¨OBJC_ASSOCIATION_RETAIN_NONATOMICå¼ºå…³è”&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;objc_setAssociatedObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MyKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WeakObjectContainer&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OBJC_ASSOCIATION_RETAIN_NONATOMIC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å–&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Objc&quot;&gt;id object = [objc_getAssociatedObject(self, &amp;amp;MyKey) object];
&lt;/code&gt;&lt;/pre&gt;</content><author><name>Ted</name></author><category term="iOS" /><summary type="html">ä¸€ã€å¼•ç”¨</summary></entry><entry><title type="html">OpenGL ESå®è·µ</title><link href="http://www.helloted.com/ios/2018/04/02/opengles_1/" rel="alternate" type="text/html" title="OpenGL ESå®è·µ" /><published>2018-04-02T20:00:00+08:00</published><updated>2018-04-02T20:00:00+08:00</updated><id>http://www.helloted.com/ios/2018/04/02/opengles_1</id><content type="html" xml:base="http://www.helloted.com/ios/2018/04/02/opengles_1/">&lt;h3 id=&quot;ä¸€æ¦‚å¿µç®€ä»‹&quot;&gt;ä¸€ã€æ¦‚å¿µç®€ä»‹&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;GPU&lt;/strong&gt;ï¼šèƒ½å¤Ÿç»“åˆå‡ ä½•ã€é¢œè‰²ã€ç¯å…‰å’Œå…¶ä»–æ•°æ®è€Œäº§ç”Ÿä¸€ä¸ªå±å¹•å›¾åƒçš„ç¡¬ä»¶ç»„ä»¶&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ¸²æŸ“&lt;/strong&gt;ï¼šæŠŠç¨‹åºæä¾›çš„å‡ ä½•æ•°æ®è½¬æ¢æˆå±å¹•ä¸Šçš„å›¾åƒçš„è¿‡ç¨‹å«åšæ¸²æŸ“ï¼Œæ¸²æŸ“çš„ç»“æœä¿å­˜åœ¨å¸§ç¼“å­˜ä¸­&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åƒç´ &lt;/strong&gt;ï¼šè®¡ç®—æœºä¸Šæ˜¾ç¤ºçš„å›¾ç‰‡éƒ½æ˜¯ç”±çŸ©å½¢çš„é¢œè‰²ç‚¹ç»„æˆï¼Œè¿™äº›é¢œè‰²ç‚¹å«åšåƒç´ ï¼Œæ¯ä¸ªåƒç´ éƒ½æ˜¯ç”±3ä¸ªé¢œè‰²å…ƒç´ ç»„æˆçš„ï¼Œä¸€ä¸ªçº¢ç‚¹ã€ä¸€ä¸ªç»¿ç‚¹å’Œä¸€ä¸ªè“ç‚¹ã€RGB&lt;/p&gt;

&lt;h4 id=&quot;ç¼“å­˜&quot;&gt;ç¼“å­˜&lt;/h4&gt;

&lt;p&gt;OpenGL ESéƒ¨åˆ†è¿è¡Œåœ¨CPUä¸Šï¼Œéƒ¨åˆ†è¿è¡Œåœ¨GPUä¸Šï¼Œåè°ƒä¸¤ä¸ªå†…å­˜åŒºåŸŸä¹‹é—´çš„æ•°æ®äº¤æ¢ï¼Œè€ŒOpenGL ESä¸ºä¸¤ä¸ªå†…å­˜åŒºåŸŸé—´çš„æ•°æ®äº¤æ¢å®šä¹‰äº†ç¼“å­˜(buffers)çš„æ¦‚å¿µï¼Œç¼“å­˜æ˜¯æŒ‡å›¾å½¢å¤„ç†å™¨èƒ½å¤Ÿæ§åˆ¶å’Œç®¡ç†çš„è¿ç»­RAMã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;OpenGL ESä¸ºç¼“å­˜æä¾›æ•°æ®çš„7ä¸ªæ­¥éª¤ï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;1ã€ç”ŸæˆglGenBuffers()â€”â€”è¯·æ±‚OpenGL ESä¸ºå›¾å½¢å¤„ç†å™¨æ§åˆ¶çš„ç¼“å­˜ç”Ÿæˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„æ ‡è¯†ç¬¦ã€‚&lt;/p&gt;

&lt;p&gt;2ã€ç»‘å®šglBindBuffer()â€”â€”å‘Šè¯‰OpenGL ESä¸ºæ¥ä¸‹æ¥çš„è¿ç®—ä½¿ç”¨ä¸€ä¸ªç¼“å­˜ã€‚&lt;/p&gt;

&lt;p&gt;3ã€ç¼“å†²æ•°æ®glBufferData()æˆ–glBufferSubData()â€”â€”è®©OpenGL ESä¸ºå½“å‰ç»‘å®šçš„ç¼“å­˜åˆ†é…ç—…åˆå§‹åŒ–è¶³å¤Ÿçš„è¿ç»­å†…å­˜ï¼ˆé€šå¸¸æ˜¯ä»CPUæ§åˆ¶çš„å†…å­˜å¤åˆ¶æ•°æ®åˆ°åˆ†é…çš„å†…å­˜ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;4ã€å¯ç”¨æˆ–è€…ç¦æ­¢glEnableVertexAttribArray()æˆ–glDisVertexAttribArray()â€”â€”å‘Šè¯‰OpenGL ESåœ¨æ¥ä¸‹æ¥çš„æ¸²æŸ“ä¸­æ˜¯å¦ä½¿ç”¨ç¼“å­˜ä¸­çš„æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;5ã€è®¾ç½®æŒ‡é’ˆglVertexAttribPointer()â€”â€”å‘Šè¯‰OpenGL ESåœ¨ç¼“å­˜ä¸­çš„æ•°æ®çš„ç±»å‹å’Œæ‰€æœ‰éœ€è¦è®¿é—®çš„æ•°æ®çš„å†…å­˜åç§»å€¼ã€‚&lt;/p&gt;

&lt;p&gt;6ã€ç»˜åˆ¶glDrawArrays()æˆ–glDrawElements()â€”â€”å‘Šè¯‰OpenGL ESä½¿ç”¨å½“å‰ç»‘å®šå¹¶å¯ç”¨çš„ç¼“å†²ä¸­çš„æ•°æ®æ¸²æŸ“æ•´ä¸ªåœºæ™¯æˆ–è€…æŸä¸ªåœºæ™¯çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;p&gt;7ã€åˆ é™¤glDeleteBuffers()â€”â€”å‘Šè¯‰OpenGL ESåˆ é™¤ä»¥å‰ç”Ÿæˆçš„ç¼“å­˜ç—…é‡Šæ”¾ç›¸å…³çš„èµ„æºã€‚&lt;/p&gt;

&lt;h4 id=&quot;å¸§ç¼“å­˜&quot;&gt;å¸§ç¼“å­˜&lt;/h4&gt;

&lt;p&gt;GPUéœ€è¦çŸ¥é“åº”è¯¥åœ¨å†…å­˜ä¸­é‚£ä¸ªä½ç½®å­˜å‚¨æ¸²æŸ“å‡ºæ¥çš„2Då›¾åƒåƒç´ æ•°æ®ï¼Œæ¥å—æ¸²æŸ“ç»“æœçš„ç¼“å­˜åŒºå«åšå¸§ç¼“å­˜ã€‚&lt;/p&gt;

&lt;p&gt;å±å¹•æ˜¾ç¤ºåƒç´ å—åˆ°ä¿å­˜åœ¨å‰å¸§ç¼“å­˜ä¸­çš„åƒç´ é¢œè‰²å…ƒç´ æ§åˆ¶ï¼Œæ‰€ä»¥ç¨‹åºå’Œæ“ä½œç³»ç»Ÿä¸ä¼šç›´æ¥æ¸²æŸ“åˆ°å‰å¸§ç¼“å­˜ä¸­ï¼Œå› ä¸ºé‚£æ ·ä¼šè®©ç”¨æˆ·çœ‹åˆ°è¿˜æ²¡æ¸²æŸ“å®Œæˆçš„å›¾åƒã€‚è€Œæ˜¯ï¼ŒæŠŠæ¸²æŸ“ç»“æœä¿å­˜åˆ°åå¸§ç¼“å­˜ä¸­ï¼Œå½“åå¸§ç¼“å­˜åŒ…å«ä¸€ä¸ª&lt;strong&gt;å®Œæˆ&lt;/strong&gt;çš„å›¾åƒï¼Œå‰åå¸§ç¼“å­˜ç¬é—´åˆ‡æ¢ï¼Œè¿™æ ·å°±å‘ˆç°äº†æ–°çš„å›¾åƒã€‚åœ¨iOSç³»ç»Ÿä¸­ï¼Œè¿™äº›æ“ä½œç”±ç³»ç»Ÿä¹‹å®¶å®Œæˆï¼Œåº”ç”¨ä¸èƒ½æ’æ‰‹ã€‚Core Animationä¼šæŠŠå¤šä¸ªå±‚ï¼ˆåº”ç”¨çš„å±‚ï¼Œç³»ç»Ÿçš„å±‚æ¯”å¦‚çŠ¶æ€æ ï¼‰æ··åˆèµ·æ¥å¹¶åœ¨åå¸§ç¼“å­˜ä¸­äº§ç”Ÿæœ€ç»ˆçš„é¢œè‰²ï¼Œç„¶ååˆ‡æ¢ç¼“å­˜ã€‚&lt;/p&gt;

&lt;h3 id=&quot;äºŒiosçš„å›¾åƒæ¶æ„&quot;&gt;äºŒã€iOSçš„å›¾åƒæ¶æ„&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_6/20.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œåœ¨iOS 8ä¹‹åï¼Œè‹¹æœæ¨å‡ºäº†metalæ¡†æ¶ç”¨æ¥å–ä»£OpenGL&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_6/21.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å…³äºCore Graphicså’ŒOpenGL ESä¹‹é—´çš„å…³ç³»ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å½“å›¾åƒæ˜¯è¦æ˜¾ç¤ºåˆ°å±å¹•ä¸Šçš„æ—¶å€™ï¼ŒOpenGL ESæ˜¯Core Graphicsçš„åº•å±‚ï¼Œç”¨äºè¿æ¥ç¡¬ä»¶&lt;/li&gt;
  &lt;li&gt;è€Œå¦‚æœæ˜¯ç¦»å±æ¸²æŸ“ï¼Œç”¨äºç”ŸæˆPDFå’Œå›¾ç‰‡æ–‡ä»¶ï¼ŒCore Graphicsåˆ™æ˜¯ä¸OpenGL ESå¤„äºå¹¶åˆ—å…³ç³»&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;Yes, on iOS Core Graphics (Quartz) appears to be layered on top of OpenGL ES for drawing that targets the screen, although not in an explicit way that we have access to.&lt;/p&gt;

  &lt;p&gt;Core Graphics takes vector elements (lines, arcs, etc.) and some raster ones (images) and processes them for display to the screen or for other forms of output (PDF files, printing, etc.). If the target is the screen on iOS, those vector elements will be hosted in a CALayer, either directly or through the backing layer of a UIView.&lt;/p&gt;

  &lt;p&gt;These Core Animation layers are effectively wrappers around rectangular textures on the GPU, which is how Core Animation can provide the smooth translation, scaling, and rotation of layers on even the original iPhone hardware. I canâ€™t find a reference for it right now, but at least one WWDC presentation states that OpenGL ES is used by Core Animation to communicate with the GPU to perform this hardware acceleration. Something similar can be observed on the new dual-GPU MacBook Pros, where the more powerful GPU kicks in when interacting with an application using Core Animation.&lt;/p&gt;

  &lt;p&gt;Because Core Graphics rasterizes the vector and raster elements into a CALayer when drawing to the screen, and a CALayer effectively wraps around an OpenGL ES texture, I would place OpenGL ES below Core Graphics on iOS, but only for the case where Core Graphics is rendering to the screen. The reason for the side-by-side placement in the hierarchy you saw may be due to three factors: on the Mac, not all views are layer-backed, so they may not be hardware accelerated in the same way; we canâ€™t really interact with the OpenGL ES backing of standard UI elements, so from a developerâ€™s point of view they are distinct concepts; and Core Graphics can be used to render to offscreen contexts, like PDF files or images.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å¼•è‡ª&lt;a href=&quot;https://stackoverflow.com/questions/7558636/ios-is-core-graphics-implemented-on-top-of-opengl&quot;&gt;iOS: is Core Graphics implemented on top of OpenGL?&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;ä¸‰helloworld&quot;&gt;ä¸‰ã€HelloWorld&lt;/h3&gt;

&lt;h4 id=&quot;1æ¸²æŸ“æ•´ä¸ªcontextçš„èƒŒæ™¯è‰²&quot;&gt;1ã€æ¸²æŸ“æ•´ä¸ªcontextçš„èƒŒæ™¯è‰²&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;viewDidLoad&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;viewDidLoad&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;GLKView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;glkView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GLKView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glkView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EAGLContext&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;initWithAPI&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kEAGLRenderingAPIOpenGLES2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glkView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;drawableColorFormat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GLKViewDrawableColorFormatRGBA8888&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glkView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;drawableDepthFormat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GLKViewDrawableDepthFormat24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;c1&quot;&gt;//å°†æ­¤â€œEAGLContextâ€å®ä¾‹è®¾ç½®ä¸ºOpenGLçš„â€œå½“å‰æ¿€æ´»â€çš„â€œContextâ€ã€‚è¿™æ ·ï¼Œä»¥åæ‰€æœ‰â€œGLâ€çš„æŒ‡ä»¤å‡ä½œç”¨åœ¨è¿™ä¸ªâ€œContextâ€ä¸Šã€‚&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EAGLContext&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setCurrentContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;glkView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;glkView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GLKView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;view&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;drawInRect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// æŒ‡å®šåˆ·æ–°æ•´ä¸ªcontexté¢œè‰²ç¼“å†²åŒºæ—¶æ‰€ç”¨çš„é¢œè‰²ï¼ŒRGBA&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glClearColor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// åˆ·æ–°ç¼“å­˜åŒº&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// GL_COLOR_BUFFER_BIT:    å½“å‰å¯å†™çš„é¢œè‰²ç¼“å†²&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// GL_DEPTH_BUFFER_BIT:    æ·±åº¦ç¼“å†²&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// GL_ACCUM_BUFFER_BIT:    ç´¯ç§¯ç¼“å†²&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// GL_STENCIL_BUFFER_BIT:  æ¨¡æ¿ç¼“å†²&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glClear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GL_COLOR_BUFFER_BIT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GL_DEPTH_BUFFER_BIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¦‚å›¾æ‰€ç¤ºï¼Œå¯ä»¥å°†æ•´ä¸ªèƒŒæ™¯æ¸²æŸ“æˆè“è‰²&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_6/23.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;è§£é‡Š&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;drawableColorFormat&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä½ çš„OpenGLä¸Šä¸‹æ–‡æœ‰ä¸€ä¸ªç¼“å†²åŒºï¼Œå®ƒç”¨ä»¥å­˜å‚¨å°†åœ¨å±å¹•ä¸­æ˜¾ç¤ºçš„é¢œè‰²ã€‚ä½ å¯ä»¥ä½¿ç”¨å…¶å±æ€§æ¥è®¾ç½®ç¼“å†²åŒºä¸­æ¯ä¸ªåƒç´ çš„é¢œè‰²æ ¼å¼ã€‚ç¼ºçœå€¼æ˜¯GLKViewDrawableColorFormatRGBA8888ï¼Œå³ç¼“å†²åŒºçš„æ¯ä¸ªåƒç´ çš„æœ€å°ç»„æˆéƒ¨åˆ†(-ä¸ªåƒç´ æœ‰å››ä¸ªå…ƒç´ ç»„æˆ RGBA)ä½¿ç”¨8ä¸ªbit(å¦‚Rä½¿ç”¨8ä¸ªbit)ï¼ˆæ‰€ä»¥æ¯ä¸ªåƒç´ 4ä¸ªå­—èŠ‚ æ—¢ 4*8 ä¸ªbitï¼‰ã€‚è¿™éå¸¸å¥½ï¼Œå› ä¸ºå®ƒç»™äº†ä½ æä¾›äº†æœ€å¹¿æ³›çš„é¢œè‰²èŒƒå›´ï¼Œè®©ä½ çš„appçœ‹èµ·æ¥æ›´å¥½ã€‚ä½†æ˜¯å¦‚æœä½ çš„appå…è®¸æ›´å°èŒƒå›´çš„é¢œè‰²ï¼Œä½ å¯ä»¥è®¾ç½®ä¸ºGLKViewDrawableColorFormatRGB565ï¼Œä»è€Œä½¿ä½ çš„appæ¶ˆè€—æ›´å°‘çš„èµ„æºï¼ˆå†…å­˜å’Œå¤„ç†æ—¶é—´ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;drawableDepthFormat&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä½ çš„OpenGLä¸Šä¸‹æ–‡è¿˜å¯ä»¥ï¼ˆå¯é€‰åœ°ï¼‰æœ‰å¦ä¸€ä¸ªç¼“å†²åŒºï¼Œç§°ä¸ºæ·±åº¦ç¼“å†²åŒºã€‚è¿™å¸®åŠ©æˆ‘ä»¬ç¡®ä¿æ›´æ¥è¿‘è§‚å¯Ÿè€…çš„å¯¹è±¡æ˜¾ç¤ºåœ¨è¿œä¸€äº›çš„å¯¹è±¡çš„å‰é¢ï¼ˆæ„æ€å°±æ˜¯ç¦»è§‚å¯Ÿè€…è¿‘ä¸€äº›çš„å¯¹è±¡ä¼šæŒ¡ä½åœ¨å®ƒåé¢çš„å¯¹è±¡ï¼‰ã€‚å…¶ç¼ºçœçš„å·¥ä½œæ–¹å¼æ˜¯ï¼šOpenGLæŠŠæ¥è¿‘è§‚å¯Ÿè€…çš„å¯¹è±¡çš„æ‰€æœ‰åƒç´ å­˜å‚¨åˆ°æ·±åº¦ç¼“å†²åŒºï¼Œå½“å¼€å§‹ç»˜åˆ¶ä¸€ä¸ªåƒç´ æ—¶ï¼Œå®ƒï¼ˆOpenGLï¼‰é¦–å…ˆæ£€æŸ¥æ·±åº¦ç¼“å†²åŒºï¼Œçœ‹æ˜¯å¦å·²ç»ç»˜åˆ¶äº†æ›´æ¥è¿‘è§‚å¯Ÿè€…çš„ä»€ä¹ˆä¸œè¥¿ï¼Œå¦‚æœæ˜¯åˆ™å¿½ç•¥å®ƒï¼ˆè¦ç»˜åˆ¶çš„åƒç´ ï¼Œå°±æ˜¯è¯´ï¼Œåœ¨ç»˜åˆ¶ä¸€ä¸ªåƒç´ ä¹‹å‰ï¼Œçœ‹çœ‹å‰é¢æœ‰æ²¡æœ‰æŒ¡ç€å®ƒçš„ä¸œè¥¿ï¼Œå¦‚æœæœ‰é‚£å°±ä¸ç”¨ç»˜åˆ¶äº†ï¼‰ã€‚å¦åˆ™ï¼ŒæŠŠå®ƒå¢åŠ åˆ°æ·±åº¦ç¼“å†²åŒºå’Œé¢œè‰²ç¼“å†²åŒºã€‚ä½ å¯ä»¥è®¾ç½®è¿™ä¸ªå±æ€§ï¼Œä»¥é€‰æ‹©æ·±åº¦ç¼“å†²åŒºçš„æ ¼å¼ã€‚ç¼ºçœå€¼æ˜¯GLKViewDrawableDepthFormatNoneï¼Œæ„å‘³ç€å®Œå…¨æ²¡æœ‰æ·±åº¦ç¼“å†²åŒºã€‚ä½†æ˜¯å¦‚æœä½ è¦ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼ˆä¸€èˆ¬ç”¨äº3Dæ¸¸æˆï¼‰ï¼Œä½ åº”è¯¥é€‰æ‹©GLKViewDrawableDepthFormat16æˆ–GLKViewDrawableDepthFormat24ã€‚è¿™é‡Œçš„å·®åˆ«æ˜¯ä½¿ç”¨GLKViewDrawableDepthFormat16å°†æ¶ˆè€—æ›´å°‘çš„èµ„æºï¼Œä½†æ˜¯å½“å¯¹è±¡éå¸¸æ¥è¿‘å½¼æ­¤æ—¶ï¼Œä½ å¯èƒ½å­˜åœ¨æ¸²æŸ“é—®é¢˜ã€‚&lt;/p&gt;

&lt;h4 id=&quot;2æ¸²æŸ“æŸä¸ªè‰²å—&quot;&gt;2ã€æ¸²æŸ“æŸä¸ªè‰²å—&lt;/h4&gt;

&lt;p&gt;OpenGL ESçš„åæ ‡ç³»ä¸Core Graphicsçš„åæ ‡ç³»ä¸ä¸€æ ·ï¼Œèµ·ç‚¹æ˜¯åœ¨å±å¹•çš„ä¸­ç‚¹ï¼Œåˆ°ä¸¤è¾¹æ˜¯1&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_6/22.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;c1&quot;&gt;// å£°æ˜é¡¶ç‚¹æ•°æ®&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;GLfloat&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vertexData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//é¡¶ç‚¹æ•°æ®ç¼“å­˜&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//è¿™å‡ è¡Œä»£ç è¡¨ç¤ºçš„å«ä¹‰æ˜¯ï¼šå£°æ˜ä¸€ä¸ªç¼“å†²åŒºçš„æ ‡è¯†ï¼ˆGLuintç±»å‹ï¼‰è®©OpenGLè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç¼“å†²åŒºå¹¶ä¸”è¿”å›è¿™ä¸ªæ ‡è¯†çš„å€¼ç»‘å®šè¿™ä¸ªç¼“å†²åŒºåˆ°å½“å‰â€œContextâ€æœ€åï¼Œå°†æˆ‘ä»¬å‰é¢é¢„å…ˆå®šä¹‰çš„é¡¶ç‚¹æ•°æ®â€œvertexDataâ€å¤åˆ¶è¿›è¿™ä¸ªç¼“å†²åŒºä¸­ã€‚å‚æ•°â€œGL_STATIC_DRAWâ€ï¼Œå®ƒè¡¨ç¤ºæ­¤ç¼“å†²åŒºå†…å®¹åªèƒ½è¢«ä¿®æ”¹ä¸€æ¬¡ï¼Œä½†å¯ä»¥æ— é™æ¬¡è¯»å–ã€‚&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;GLuint&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glGenBuffers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glBindBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GL_ARRAY_BUFFER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glBufferData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GL_ARRAY_BUFFER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vertexData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vertexData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GL_STATIC_DRAW&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// æ¿€æ´»é¡¶ç‚¹å±æ€§ï¼ˆé»˜è®¤å®ƒçš„å…³é—­çš„ï¼‰&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glEnableVertexAttribArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GLKVertexAttribPosition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// å¡«å……é¡¶ç‚¹æ•°æ®ï¼Œé¡¶ç‚¹å±æ€§ç´¢å¼•ï¼ˆè¿™é‡Œæ˜¯ä½ç½®ï¼‰ã€3ä¸ªåˆ†é‡çš„çŸ¢é‡ã€ç±»å‹æ˜¯æµ®ç‚¹ï¼ˆGL_FLOATï¼‰ã€å¡«å……æ—¶ä¸éœ€è¦å•ä½åŒ–ï¼ˆGL_FALSEï¼‰ã€åœ¨æ•°æ®æ•°ç»„ä¸­æ¯è¡Œçš„è·¨åº¦æ˜¯12ä¸ªå­—èŠ‚ï¼ˆ4*3=12ã€‚ä»é¢„å®šä¹‰çš„æ•°ç»„ä¸­å¯çœ‹å‡ºï¼Œæ¯è¡Œæœ‰3ä¸ªGL_FLOATæµ®ç‚¹å€¼ï¼Œè€ŒGL_FLOATå 4ä¸ªå­—èŠ‚ï¼Œå› æ­¤æ¯ä¸€è¡Œçš„è·¨åº¦æ˜¯4*3ï¼‰ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªåç§»é‡çš„æŒ‡é’ˆï¼Œç”¨æ¥ç¡®å®šâ€œç¬¬ä¸€ä¸ªæ•°æ®â€å°†ä»å†…å­˜æ•°æ®å—çš„ä»€ä¹ˆåœ°æ–¹å¼€å§‹ã€‚&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glVertexAttribPointer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GLKVertexAttribPosition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GL_FLOAT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GL_FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GLfloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GLfloat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// ç€è‰²å™¨&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mEffect&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GLKBaseEffect&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ç€è‰²å™¨çš„é¢œè‰²&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mEffect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;constantColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GLKVector4Make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
 &lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;glkView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GLKView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;view&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;drawInRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// æŒ‡å®šåˆ·æ–°æ•´ä¸ªcontexté¢œè‰²ç¼“å†²åŒºæ—¶æ‰€ç”¨çš„é¢œè‰²ï¼ŒRGBA&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glClearColor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// åˆ·æ–°ç¼“å­˜åŒº&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// GL_COLOR_BUFFER_BIT:    å½“å‰å¯å†™çš„é¢œè‰²ç¼“å†²&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// GL_DEPTH_BUFFER_BIT:    æ·±åº¦ç¼“å†²&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// GL_ACCUM_BUFFER_BIT:    ç´¯ç§¯ç¼“å†²&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// GL_STENCIL_BUFFER_BIT:  æ¨¡æ¿ç¼“å†²&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glClear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GL_COLOR_BUFFER_BIT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GL_DEPTH_BUFFER_BIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
   &lt;span class=&quot;c1&quot;&gt;//å¯åŠ¨ç€è‰²å™¨&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mEffect&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;prepareToDraw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
   &lt;span class=&quot;c1&quot;&gt;// ç”»å‡ºä¸‰è§’å½¢&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;glDrawArrays&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GL_TRIANGLES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_6/24.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;</content><author><name>Ted</name></author><category term="iOS" /><summary type="html">ä¸€ã€æ¦‚å¿µç®€ä»‹</summary></entry><entry><title type="html">APPç”Ÿæˆä¸è¿è¡Œ(äºŒ)</title><link href="http://www.helloted.com/ios/2018/03/31/app-2/" rel="alternate" type="text/html" title="APPç”Ÿæˆä¸è¿è¡Œ(äºŒ)" /><published>2018-03-31T20:00:00+08:00</published><updated>2018-03-31T20:00:00+08:00</updated><id>http://www.helloted.com/ios/2018/03/31/app-2</id><content type="html" xml:base="http://www.helloted.com/ios/2018/03/31/app-2/">&lt;h3 id=&quot;ä¸€å¯åŠ¨è¿‡ç¨‹&quot;&gt;ä¸€ã€å¯åŠ¨è¿‡ç¨‹&lt;/h3&gt;

&lt;p&gt;iOSå¼€å‘ä¸­ï¼Œmainå‡½æ•°æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ç¨‹åºå¯åŠ¨å…¥å£ï¼Œä½†å®é™…ä¸Šå¹¶éçœŸæ­£æ„ä¹‰ä¸Šçš„å…¥å£ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬è¿è¡Œç¨‹åºï¼Œå†åˆ°mainæ–¹æ³•è¢«è°ƒç”¨ä¹‹é—´ï¼Œç¨‹åºå·²ç»åšäº†è®¸è®¸å¤šå¤šçš„äº‹æƒ…ï¼Œæ¯”å¦‚æˆ‘ä»¬ç†ŸçŸ¥çš„runtimeçš„åˆå§‹åŒ–å°±å‘ç”Ÿåœ¨mainå‡½æ•°è°ƒç”¨å‰ï¼Œè¿˜æœ‰ç¨‹åºåŠ¨æ€åº“çš„åŠ è½½é“¾æ¥ä¹Ÿå‘ç”Ÿåœ¨è¿™é˜¶æ®µã€‚&lt;/p&gt;

&lt;p&gt;æ•´ä¸ªè¿‡ç¨‹ä¸ºï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç³»ç»Ÿå…ˆè¯»å–Appçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆMach-Oæ–‡ä»¶ï¼‰ï¼Œä»é‡Œé¢è·å¾—dyldçš„è·¯å¾„&lt;/li&gt;
  &lt;li&gt;åŠ è½½dyldï¼ˆthe dynamic link editorï¼ŒApple çš„åŠ¨æ€é“¾æ¥å™¨ï¼Œç³»ç»Ÿ kernel åšå¥½å¯åŠ¨ç¨‹åºçš„åˆå§‹å‡†å¤‡åï¼Œäº¤ç»™ dyld è´Ÿè´£ï¼‰ï¼Œdyldå»åˆå§‹åŒ–è¿è¡Œç¯å¢ƒï¼Œå¼€å¯ç¼“å­˜ç­–ç•¥ï¼Œ&lt;/li&gt;
  &lt;li&gt;dyldåŠ è½½ç¨‹åºç›¸å…³åŠ¨æ€åº“ï¼Œå¹¶å¯¹è¿™äº›åº“è¿›è¡Œé“¾æ¥,è°ƒç”¨æ¯ä¸ªä¾èµ–åº“çš„åˆå§‹åŒ–æ–¹æ³•&lt;/li&gt;
  &lt;li&gt;runtimeè¢«åˆå§‹åŒ–&lt;/li&gt;
  &lt;li&gt;ImageLoader:dyldæŠŠImageï¼ˆåŒ…å«æˆ‘ä»¬çš„ç±»ã€æ–¹æ³•ç­‰ï¼‰loadè¿›æ¥&lt;/li&gt;
  &lt;li&gt;runtimeå¯¹åŠ è½½è¿›æ¥çš„Imageæ‰€æœ‰ç±»è¿›è¡Œç±»ç»“æ„åˆå§‹åŒ–ï¼Œè°ƒç”¨æ‰€æœ‰çš„loadæ–¹æ³•ï¼ŒCategoryæ–¹æ³•ä¹Ÿåœ¨æ­¤æ—¶è¢«è°ƒç”¨&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;dyldè¿”å›mainå‡½æ•°åœ°å€ï¼Œmainå‡½æ•°è¢«è°ƒç”¨&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;mainå‡½æ•°è°ƒç”¨&lt;/li&gt;
  &lt;li&gt;æ‰§è¡ŒAppDelegateçš„ä»£ç†æ–¹æ³•ï¼Œä¸»è¦æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;didFinishLaunchingWithOptions&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;åˆå§‹åŒ–Windowï¼Œåˆå§‹åŒ–åŸºç¡€çš„ViewControllerç»“æ„&lt;/li&gt;
  &lt;li&gt;è·å–æ•°æ®(Local DBï¼Network)ï¼Œå±•ç¤ºç»™ç”¨æˆ·&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æ€»ä½“å¯ä»¥åˆ†ä¸ºmainå‡½æ•°è°ƒç”¨ä¹‹å‰å’Œmainå‡½æ•°è°ƒç”¨ä¹‹åã€‚&lt;/p&gt;

&lt;h3 id=&quot;äºŒmainå‡½æ•°å¯åŠ¨ä¹‹å‰&quot;&gt;äºŒã€mainå‡½æ•°å¯åŠ¨ä¹‹å‰&lt;/h3&gt;

&lt;h4 id=&quot;mach-oå¯æ‰§è¡Œæ–‡ä»¶&quot;&gt;Mach-Oå¯æ‰§è¡Œæ–‡ä»¶&lt;/h4&gt;

&lt;p&gt;Mach-Oæ–‡ä»¶æ ¼å¼æ˜¯ OS X ä¸ iOS ç³»ç»Ÿä¸Šçš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼Œåƒæˆ‘ä»¬ç¼–è¯‘è¿‡ç¨‹äº§ç”Ÿçš„.Oæ–‡ä»¶ï¼Œä»¥åŠç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒåŠ¨æ€åº“ç­‰éƒ½æ˜¯Mach-Oæ–‡ä»¶ã€‚æœ‰ä»¥ä¸‹å‡ ç§Mach-O&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Executable å¯æ‰§è¡Œæ–‡ä»¶&lt;/li&gt;
  &lt;li&gt;Dylib åŠ¨æ€åº“&lt;/li&gt;
  &lt;li&gt;Bundle åº“ï¼šæ— æ³•è¢«è¿æ¥çš„åŠ¨æ€åº“ï¼Œåªèƒ½é€šè¿‡dlopen()åŠ è½½&lt;/li&gt;
  &lt;li&gt;Image ï¼šæŒ‡çš„æ˜¯Executableï¼ŒDylibæˆ–è€…Bundleçš„ä¸€ç§ï¼Œæ–‡ä¸­ä¼šå¤šæ¬¡ä½¿ç”¨Imageè¿™ä¸ªåè¯ã€‚&lt;/li&gt;
  &lt;li&gt;Framework åº“ï¼šåŠ¨æ€åº“å’Œå¯¹åº”çš„å¤´æ–‡ä»¶å’Œèµ„æºæ–‡ä»¶çš„é›†åˆ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Mach-Oçš„ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/11.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Header å¤´éƒ¨ï¼ŒåŒ…å«å¯ä»¥æ‰§è¡Œçš„CPUæ¶æ„ï¼Œæ¯”å¦‚x86,arm64&lt;/li&gt;
  &lt;li&gt;Load commands åŠ è½½å‘½ä»¤ï¼ŒåŒ…å«æ–‡ä»¶çš„ç»„ç»‡æ¶æ„å’Œåœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„å¸ƒå±€æ–¹å¼&lt;/li&gt;
  &lt;li&gt;Dataï¼Œæ•°æ®ï¼ŒåŒ…å«load commandsä¸­éœ€è¦çš„å„ä¸ªæ®µ(segment)çš„æ•°æ®ï¼Œæ¯ä¸€ä¸ªSegmentéƒ½å¾—å¤§å°æ˜¯Pageçš„æ•´æ•°å€ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ›´å¤šMach-Oå¯æŸ¥çœ‹ã€Š&lt;a href=&quot;https://github.com/LeoMobileDeveloper/React-Native-Files/blob/master/Mac%20OS%20X%20ABI%20Mach-O%20File%20Format%20Reference.pdf&quot;&gt;Mac OS X ABI Mach-O File Format Reference&lt;/a&gt;ã€‹&lt;/p&gt;

&lt;p&gt;æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªAPPåŠ¨æ€è°ƒç”¨çš„ç³»ç»Ÿå¯æ‰§è¡Œæ–‡ä»¶&lt;/p&gt;

&lt;p&gt;1ã€é€šè¿‡&lt;a href=&quot;https://sourceforge.net/projects/machoview/?source=navbar&quot;&gt;machoview&lt;/a&gt;,é€‰æ‹©APPçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/12.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;2ã€é€šè¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;otool -L&lt;/code&gt;å‘½ä»¤è¡ŒæŸ¥çœ‹&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/13.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;dyld&quot;&gt;dyld&lt;/h4&gt;

&lt;p&gt;å…¨ç¨‹the dynamic loadeï¼ŒApple çš„åŠ¨æ€é“¾æ¥å™¨ï¼Œç³»ç»Ÿ kernel åšå¥½å¯åŠ¨ç¨‹åºçš„åˆå§‹å‡†å¤‡åï¼Œäº¤ç»™ dyld è´Ÿè´£ã€‚&lt;/p&gt;

&lt;p&gt;2017å¹´ï¼Œè‹¹æœå¼•å…¥äº†Dyld 3.0ï¼Œä½†æ˜¯åªæœ‰ç³»ç»ŸAPPé‡‡ç”¨è¿™ä¸ªï¼Œç¬¬ä¸‰æ–¹APPéƒ½æ˜¯é‡‡ç”¨Dyld 2.0ã€‚&lt;/p&gt;

&lt;p&gt;Dyld 2.0çš„åŠ è½½è¿‡ç¨‹æ˜¯ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/14.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;è§£æ mach-o æ–‡ä»¶ï¼Œæ‰¾åˆ°å…¶ä¾èµ–çš„åº“ï¼Œå¹¶ä¸”é€’å½’çš„æ‰¾åˆ°æ‰€æœ‰ä¾èµ–çš„åº“ï¼Œå½¢æˆä¸€å¼ åŠ¨æ€åº“çš„ä¾èµ–å›¾ã€‚iOS ä¸Šçš„å¤§éƒ¨åˆ† app éƒ½ä¾èµ– 300 åˆ° 600 ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œæ‰€ä»¥è¿™ä¸ªæ­¥éª¤åŒ…å«äº†è¾ƒå¤§çš„å·¥ä½œé‡ã€‚&lt;/li&gt;
  &lt;li&gt;åŒ¹é… mach-o æ–‡ä»¶åˆ°è‡ªèº«çš„åœ°å€ç©ºé—´ï¼›&lt;/li&gt;
  &lt;li&gt;è¿›è¡Œç¬¦å·æŸ¥æ‰¾ï¼šæ¯”å¦‚ app ä¸­è°ƒç”¨äº† printf æ–¹æ³•ï¼Œå°±éœ€è¦å»ç³»ç»Ÿåº“ä¸­æŸ¥æ‰¾åˆ° printf çš„åœ°å€ï¼Œç„¶åå°†åœ°å€æ‹·è´åˆ° app ä¸­çš„å‡½æ•°æŒ‡é’ˆä¸­ï¼›&lt;/li&gt;
  &lt;li&gt;ç»‘å®šå’Œå˜åŸºï¼šç”±äº app éœ€è¦è®©åœ°å€ç©ºé—´é…ç½®éšæœºåŠ è½½ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æŒ‡é’ˆéƒ½éœ€è¦åŠ ä¸Šä¸€ä¸ªåŸºåœ°å€ï¼›&lt;/li&gt;
  &lt;li&gt;è¿è¡Œåˆå§‹åŒ–ç¨‹åºï¼ˆRuntimeã€+loadã€+initializeï¼‰ï¼Œä¹‹åè¿è¡Œ main() å‡½æ•°ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;ä¸‰ä¼˜åŒ–å¯åŠ¨æ—¶é—´&quot;&gt;ä¸‰ã€ä¼˜åŒ–å¯åŠ¨æ—¶é—´&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;mainå‡½æ•°ä¹‹å&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;è¿™éƒ¨åˆ†æ˜¯ä¸»è¦çš„ä¼˜åŒ–éƒ¨åˆ†&lt;/p&gt;

&lt;h4 id=&quot;appdelegate&quot;&gt;Appdelegate&lt;/h4&gt;

&lt;p&gt;èƒ½å»¶è¿Ÿåˆå§‹åŒ–çš„å°½é‡å»¶è¿Ÿåˆå§‹åŒ–ï¼Œä¸èƒ½å»¶è¿Ÿåˆå§‹åŒ–çš„å°½é‡æ”¾åˆ°åå°åˆå§‹åŒ–ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸‰æ–¹SDKåˆå§‹åŒ–ï¼Œæ¯”å¦‚Crashç»Ÿè®¡; åƒåˆ†äº«ä¹‹ç±»çš„ï¼Œå¯ä»¥ç­‰åˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨å†å‡ºåˆå§‹åŒ–ã€‚&lt;/li&gt;
  &lt;li&gt;åˆå§‹åŒ–æŸäº›åŸºç¡€æœåŠ¡ï¼Œæ¯”å¦‚WatchDogï¼Œè¿œç¨‹å‚æ•°ã€‚&lt;/li&gt;
  &lt;li&gt;å¯åŠ¨ç›¸å…³æ—¥å¿—ï¼Œæ—¥å¿—å¾€å¾€æ¶‰åŠåˆ°DBæ“ä½œï¼Œä¸€å®šè¦æ”¾åˆ°åå°å»åš&lt;/li&gt;
  &lt;li&gt;ä¸šåŠ¡æ–¹åˆå§‹åŒ–ï¼Œè¿™ä¸ªäº¤ç”±æ¯ä¸ªä¸šåŠ¡è‡ªå·±å»æ§åˆ¶åˆå§‹åŒ–æ—¶é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;å¯åŠ¨ä¸šåŠ¡çš„ä¼˜åŒ–&quot;&gt;å¯åŠ¨ä¸šåŠ¡çš„ä¼˜åŒ–&lt;/h4&gt;

&lt;p&gt;å»ºä¸€ä¸ªç±»æ¥ç®¡ç†åˆå§‹åŒ–ï¼Œæ‰€æœ‰éœ€è¦åˆå§‹åŒ–çš„ä»£ç éƒ½åœ¨è¿™é‡Œè¿›è¡Œï¼Œåˆ†ç±»åˆå§‹åŒ–ï¼š&lt;/p&gt;

&lt;p&gt;1)ã€æ—¥å¿— / ç»Ÿè®¡ç­‰éœ€è¦ç¬¬ä¸€æ—¶é—´å¯åŠ¨çš„, ä»ç„¶ä¼´éš didFinishLaunchingWithOptions å¯åŠ¨.&lt;/p&gt;

&lt;p&gt;2)ã€ç”¨æˆ·æ•°æ®éœ€è¦åœ¨å¹¿å‘Šæ˜¾ç¤ºå®Œæˆä»¥åä½¿ç”¨, æ‰€ä»¥éœ€è¦ä¼´éšå¹¿å‘Šé¡µå¯åŠ¨ã€‚&lt;/p&gt;

&lt;p&gt;3)ã€æ¯”å¦‚åˆ†äº«ä¸šåŠ¡, è‚¯å®šæ˜¯ç”¨æˆ·èƒ½çœ‹åˆ°çœŸæ­£çš„ä¸»ç•Œé¢ä»¥åæ‰éœ€è¦å¯åŠ¨, æ‰€ä»¥æ¨è¿Ÿåˆ°ä¸»ç•Œé¢åŠ è½½å®Œæˆä»¥åå¯åŠ¨, åªéœ€è¦å°†ä»£ç æ”¾åˆ°æ–¹æ³•é‡Œã€‚&lt;/p&gt;

&lt;h4 id=&quot;viewcontroller&quot;&gt;ViewController&lt;/h4&gt;

&lt;p&gt;å»¶è¿Ÿåˆå§‹åŒ–é‚£äº›ä¸å¿…è¦çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;UIViewController&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ç”¨time-profileræ‰¾åˆ°å…ƒå‡¶&quot;&gt;ç”¨Time Profileræ‰¾åˆ°å…ƒå‡¶&lt;/h4&gt;

&lt;p&gt;Time Profileråœ¨åˆ†ææ—¶é—´å ç”¨ä¸Šéå¸¸å¼ºå¤§ã€‚å®ç”¨çš„æ—¶å€™æ³¨æ„ä¸‰ç‚¹&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åœ¨æ‰“åŒ…æ¨¡å¼ä¸‹åˆ†æï¼ˆä¸€èˆ¬æ˜¯Releaseï¼‰,è¿™æ ·å’Œçº¿ä¸Šç¯å¢ƒä¸€æ ·ã€‚&lt;/li&gt;
  &lt;li&gt;è®°å¾—å¼€å¯dsymï¼Œä¸ç„¶æ— æ³•æŸ¥çœ‹åˆ°å…·ä½“çš„å‡½æ•°è°ƒç”¨å †æ ˆ&lt;/li&gt;
  &lt;li&gt;åˆ†ææ€§èƒ½å·®çš„è®¾å¤‡ï¼Œå¯¹äºæ”¯æŒiOS 8çš„ï¼Œä¸€èˆ¬åˆ†æiphone 4sæˆ–è€…iphone 5ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/15.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Mainå‡½æ•°ä¹‹å‰&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Mainå‡½æ•°ä¹‹å‰æ˜¯iOSç³»ç»Ÿçš„å·¥ä½œï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†çš„ä¼˜åŒ–å¾€å¾€æ›´å…·æœ‰é€šç”¨æ€§ã€‚&lt;/p&gt;

&lt;h4 id=&quot;dylibs&quot;&gt;dylibs&lt;/h4&gt;

&lt;p&gt;å¯åŠ¨çš„ç¬¬ä¸€æ­¥æ˜¯åŠ è½½åŠ¨æ€åº“ï¼ŒåŠ è½½ç³»ç»Ÿçš„åŠ¨æ€åº“ä½¿å¾ˆå¿«çš„ï¼Œå› ä¸ºå¯ä»¥ç¼“å­˜ï¼Œè€ŒåŠ è½½å†…åµŒçš„åŠ¨æ€åº“é€Ÿåº¦è¾ƒæ…¢ã€‚æ‰€ä»¥ï¼Œæé«˜è¿™ä¸€æ­¥çš„æ•ˆç‡çš„å…³é”®æ˜¯ï¼š&lt;strong&gt;å‡å°‘åŠ¨æ€åº“çš„æ•°é‡&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åˆå¹¶åŠ¨æ€åº“ï¼Œæ¯”å¦‚å…¬å¸å†…éƒ¨ç”±ç§æœ‰Podå»ºç«‹äº†å¦‚ä¸‹åŠ¨æ€åº“ï¼šXXTableView, XXHUD, XXLabelï¼Œå¼ºçƒˆå»ºè®®åˆå¹¶æˆä¸€ä¸ªXXUIKitæ¥æé«˜åŠ è½½é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;rebase--bind--objective-c-runtime&quot;&gt;Rebase &amp;amp; Bind &amp;amp; Objective C Runtime&lt;/h4&gt;

&lt;p&gt;Rebaseå’ŒBindéƒ½æ˜¯ä¸ºäº†è§£å†³æŒ‡é’ˆå¼•ç”¨çš„é—®é¢˜ã€‚å¯¹äºObjective Cå¼€å‘æ¥è¯´ï¼Œä¸»è¦çš„æ—¶é—´æ¶ˆè€—åœ¨Class/Methodçš„ç¬¦å·åŠ è½½ä¸Šï¼Œæ‰€ä»¥å¸¸è§çš„ä¼˜åŒ–æ–¹æ¡ˆæ˜¯ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å‡å°‘&lt;code class=&quot;highlighter-rouge&quot;&gt;__DATA&lt;/code&gt;æ®µä¸­çš„æŒ‡é’ˆæ•°é‡ã€‚&lt;/li&gt;
  &lt;li&gt;åˆå¹¶Categoryå’ŒåŠŸèƒ½ç±»ä¼¼çš„ç±»ã€‚æ¯”å¦‚ï¼šUIView+Frame,UIView+AutoLayoutâ€¦åˆå¹¶ä¸ºä¸€ä¸ª&lt;/li&gt;
  &lt;li&gt;åˆ é™¤æ— ç”¨çš„æ–¹æ³•å’Œç±»ã€‚&lt;/li&gt;
  &lt;li&gt;å¤šç”¨Swift Structsï¼Œå› ä¸ºSwfit Structsæ˜¯é™æ€åˆ†å‘çš„ã€‚æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹æˆ‘ä¹‹å‰è¿™ç¯‡æ–‡ç« ï¼šã€Š&lt;a href=&quot;http://blog.csdn.net/hello_hwc/article/details/53147910&quot;&gt;Swiftè¿›é˜¶ä¹‹å†…å­˜æ¨¡å‹å’Œæ–¹æ³•è°ƒåº¦&lt;/a&gt;ã€‹&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;initializers&quot;&gt;Initializers&lt;/h4&gt;

&lt;p&gt;é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šåœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;+load&lt;/code&gt;æ–¹æ³•ä¸­è¿›è¡Œmethod-swizzlingï¼Œè¿™ä¹Ÿæ˜¯&lt;a href=&quot;http://nshipster.com/method-swizzling/&quot;&gt;Nshipster&lt;/a&gt;æ¨èçš„æ–¹å¼ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç”¨initializeæ›¿ä»£loadã€‚ä¸å°‘åŒå­¦å–œæ¬¢ç”¨method-swizzlingæ¥å®ç°AOPå»åšæ—¥å¿—ç»Ÿè®¡ç­‰å†…å®¹ï¼Œå¼ºçƒˆå»ºè®®æ”¹ä¸ºåœ¨initializeè¿›è¡Œåˆå§‹åŒ–ã€‚&lt;/li&gt;
  &lt;li&gt;å‡å°‘&lt;code class=&quot;highlighter-rouge&quot;&gt;__atribute__((constructor))&lt;/code&gt;çš„ä½¿ç”¨ï¼Œè€Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™æ‰ç”¨dispatch_onceç­‰æ–¹å¼åˆå§‹åŒ–ã€‚&lt;/li&gt;
  &lt;li&gt;ä¸è¦åˆ›å»ºçº¿ç¨‹&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨Swfité‡å†™ä»£ç ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å››ios-é™æ€åº“åŠ¨æ€åº“ä¸-framework&quot;&gt;å››ã€iOS é™æ€åº“ï¼ŒåŠ¨æ€åº“ä¸ Framework&lt;/h3&gt;

&lt;h4 id=&quot;é™æ€åº“ä¸åŠ¨æ€åº“çš„åŒºåˆ«&quot;&gt;é™æ€åº“ä¸åŠ¨æ€åº“çš„åŒºåˆ«&lt;/h4&gt;

&lt;p&gt;é¦–å…ˆæ¥çœ‹ä»€ä¹ˆæ˜¯åº“ï¼Œåº“(Library)è¯´ç™½äº†å°±æ˜¯ä¸€æ®µç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ä»£ç ï¼ŒåŠ ä¸Šå¤´æ–‡ä»¶å°±å¯ä»¥ä¾›åˆ«äººä½¿ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;ä»€ä¹ˆæ—¶å€™æˆ‘ä»¬ä¼šç”¨åˆ°åº“å‘¢ï¼Ÿä¸€ç§æƒ…å†µæ˜¯æŸäº›ä»£ç éœ€è¦ç»™åˆ«äººä½¿ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›åˆ«äººçœ‹åˆ°æºç ï¼Œå°±éœ€è¦ä»¥åº“çš„å½¢å¼è¿›è¡Œå°è£…ï¼Œåªæš´éœ²å‡ºå¤´æ–‡ä»¶ã€‚å¦å¤–ä¸€ç§æƒ…å†µæ˜¯ï¼Œå¯¹äºæŸäº›ä¸ä¼šè¿›è¡Œå¤§çš„æ”¹åŠ¨çš„ä»£ç ï¼Œæˆ‘ä»¬æƒ³å‡å°‘ç¼–è¯‘çš„æ—¶é—´ï¼Œå°±å¯ä»¥æŠŠå®ƒæ‰“åŒ…æˆåº“ï¼Œå› ä¸ºåº“æ˜¯å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶äº†ï¼Œç¼–è¯‘çš„æ—¶å€™åªéœ€è¦ Link ä¸€ä¸‹ï¼Œä¸ä¼šæµªè´¹ç¼–è¯‘æ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;ä¸Šé¢æåˆ°åº“åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦ Linkï¼ŒLink çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œé™æ€å’ŒåŠ¨æ€ï¼Œäºæ˜¯ä¾¿äº§ç”Ÿäº†é™æ€åº“å’ŒåŠ¨æ€åº“ã€‚&lt;/p&gt;

&lt;h4 id=&quot;é™æ€åº“&quot;&gt;é™æ€åº“&lt;/h4&gt;

&lt;p&gt;é™æ€åº“å³é™æ€é“¾æ¥åº“ï¼ˆWindows ä¸‹çš„ .libï¼ŒLinux å’Œ Mac ä¸‹çš„ .aï¼‰ã€‚ä¹‹æ‰€ä»¥å«åšé™æ€ï¼Œæ˜¯å› ä¸ºé™æ€åº“åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šè¢«ç›´æ¥æ‹·è´ä¸€ä»½ï¼Œå¤åˆ¶åˆ°ç›®æ ‡ç¨‹åºé‡Œï¼Œè¿™æ®µä»£ç åœ¨ç›®æ ‡ç¨‹åºé‡Œå°±ä¸ä¼šå†æ”¹å˜äº†ã€‚&lt;/p&gt;

&lt;p&gt;é™æ€åº“çš„å¥½å¤„å¾ˆæ˜æ˜¾ï¼Œç¼–è¯‘å®Œæˆä¹‹åï¼Œåº“æ–‡ä»¶å®é™…ä¸Šå°±æ²¡æœ‰ä½œç”¨äº†ã€‚ç›®æ ‡ç¨‹åºæ²¡æœ‰å¤–éƒ¨ä¾èµ–ï¼Œç›´æ¥å°±å¯ä»¥è¿è¡Œã€‚å½“ç„¶å…¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯ä¼šä½¿ç”¨ç›®æ ‡ç¨‹åºçš„ä½“ç§¯å¢å¤§ã€‚&lt;/p&gt;

&lt;h4 id=&quot;åŠ¨æ€åº“&quot;&gt;åŠ¨æ€åº“&lt;/h4&gt;

&lt;p&gt;åŠ¨æ€åº“å³åŠ¨æ€é“¾æ¥åº“ï¼ˆWindows ä¸‹çš„ .dllï¼ŒLinux ä¸‹çš„ .soï¼ŒMac ä¸‹çš„ .dylib/.tbdï¼‰ã€‚ä¸é™æ€åº“ç›¸åï¼ŒåŠ¨æ€åº“åœ¨ç¼–è¯‘æ—¶å¹¶ä¸ä¼šè¢«æ‹·è´åˆ°ç›®æ ‡ç¨‹åºä¸­ï¼Œç›®æ ‡ç¨‹åºä¸­åªä¼šå­˜å‚¨æŒ‡å‘åŠ¨æ€åº“çš„å¼•ç”¨ã€‚ç­‰åˆ°ç¨‹åºè¿è¡Œæ—¶ï¼ŒåŠ¨æ€åº“æ‰ä¼šè¢«çœŸæ­£åŠ è½½è¿›æ¥ã€‚&lt;/p&gt;

&lt;p&gt;åŠ¨æ€åº“çš„ä¼˜ç‚¹æ˜¯ï¼Œä¸éœ€è¦æ‹·è´åˆ°ç›®æ ‡ç¨‹åºä¸­ï¼Œä¸ä¼šå½±å“ç›®æ ‡ç¨‹åºçš„ä½“ç§¯ï¼Œè€Œä¸”åŒä¸€ä»½åº“å¯ä»¥è¢«å¤šä¸ªç¨‹åºä½¿ç”¨ï¼ˆå› ä¸ºè¿™ä¸ªåŸå› ï¼ŒåŠ¨æ€åº“ä¹Ÿè¢«ç§°ä½œ&lt;strong&gt;å…±äº«åº“&lt;/strong&gt;ï¼‰ã€‚åŒæ—¶ï¼Œç¼–è¯‘æ—¶æ‰è½½å…¥çš„ç‰¹æ€§ï¼Œä¹Ÿå¯ä»¥è®©æˆ‘ä»¬éšæ—¶å¯¹åº“è¿›è¡Œæ›¿æ¢ï¼Œè€Œä¸éœ€è¦é‡æ–°ç¼–è¯‘ä»£ç ã€‚åŠ¨æ€åº“å¸¦æ¥çš„é—®é¢˜ä¸»è¦æ˜¯ï¼ŒåŠ¨æ€è½½å…¥ä¼šå¸¦æ¥ä¸€éƒ¨åˆ†æ€§èƒ½æŸå¤±ï¼Œä½¿ç”¨åŠ¨æ€åº“ä¹Ÿä¼šä½¿å¾—ç¨‹åºä¾èµ–äºå¤–éƒ¨ç¯å¢ƒã€‚å¦‚æœç¯å¢ƒç¼ºå°‘åŠ¨æ€åº“æˆ–è€…åº“çš„ç‰ˆæœ¬ä¸æ­£ç¡®ï¼Œå°±ä¼šå¯¼è‡´ç¨‹åºæ— æ³•è¿è¡Œï¼ˆLinux ä¸‹å–œé—»ä¹è§çš„ lib not found é”™è¯¯ï¼‰ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ios-framework&quot;&gt;iOS Framework&lt;/h4&gt;

&lt;p&gt;é™¤äº†ä¸Šé¢æåˆ°çš„ .a å’Œ .dylib/.tbd ä¹‹å¤–ï¼ŒMac OS/iOS å¹³å°è¿˜å¯ä»¥ä½¿ç”¨ Frameworkã€‚Framework å®é™…ä¸Šæ˜¯ä¸€ç§æ‰“åŒ…æ–¹å¼ï¼Œå°†åº“çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¤´æ–‡ä»¶å’Œæœ‰å…³çš„èµ„æºæ–‡ä»¶æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œæ–¹ä¾¿ç®¡ç†å’Œåˆ†å‘ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ iOS 8 ä¹‹å‰ï¼ŒiOS å¹³å°ä¸æ”¯æŒä½¿ç”¨åŠ¨æ€ Frameworkï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨çš„ Framework åªæœ‰è‹¹æœè‡ªå®¶çš„ UIKit.Frameworkï¼ŒFoundation.Framework ç­‰ã€‚è¿™ç§é™åˆ¶å¯èƒ½æ˜¯å‡ºäºå®‰å…¨çš„è€ƒè™‘ï¼ˆè§&lt;a href=&quot;https://stackoverflow.com/questions/4733847/can-you-build-dynamic-libraries-for-ios-and-load-them-at-runtime&quot;&gt;è¿™é‡Œçš„è®¨è®º&lt;/a&gt;)ã€‚æ¢ä¸€ä¸ªè§’åº¦è®²ï¼Œå› ä¸º iOS åº”ç”¨éƒ½æ˜¯è¿è¡Œåœ¨æ²™ç›’å½“ä¸­ï¼Œä¸åŒçš„ç¨‹åºä¹‹é—´ä¸èƒ½å…±äº«ä»£ç ï¼ŒåŒæ—¶åŠ¨æ€ä¸‹è½½ä»£ç åˆæ˜¯è¢«è‹¹æœæ˜ä»¤ç¦æ­¢çš„ï¼Œæ²¡åŠæ³•å‘æŒ¥å‡ºåŠ¨æ€åº“çš„ä¼˜åŠ¿ï¼Œå®é™…ä¸ŠåŠ¨æ€åº“ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ã€‚&lt;/p&gt;

&lt;p&gt;ç”±äºä¸Šé¢æåˆ°çš„é™åˆ¶ï¼Œå¼€å‘è€…æƒ³è¦åœ¨ iOS å¹³å°å…±äº«ä»£ç ï¼Œå”¯ä¸€çš„é€‰æ‹©å°±æ˜¯æ‰“åŒ…æˆé™æ€åº“ .a æ–‡ä»¶ï¼ŒåŒæ—¶é™„ä¸Šå¤´æ–‡ä»¶ï¼ˆä¾‹å¦‚&lt;a href=&quot;https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;amp;t=resource/res_list&amp;amp;verify=1&amp;amp;id=open1419319164&amp;amp;token=&amp;amp;lang=zh_CN&quot;&gt;å¾®ä¿¡çš„SDK&lt;/a&gt;ï¼‰ã€‚ä½†æ˜¯è¿™æ ·çš„æ‰“åŒ…æ–¹å¼ä¸å¤Ÿæ–¹ä¾¿ï¼Œä½¿ç”¨æ—¶ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œå¤§å®¶è¿˜æ˜¯å¸Œæœ›å…±äº«ä»£ç éƒ½èƒ½èƒ½åƒ Framework ä¸€æ ·ï¼Œç›´æ¥æ‰”åˆ°å·¥ç¨‹é‡Œå°±å¯ä»¥ç”¨ã€‚äºæ˜¯äººä»¬æƒ³å‡ºäº†å„ç§å¥‡æŠ€æ·«å·§å»è®© Xcode Build å‡º iOS å¯ä»¥ä½¿ç”¨çš„ Frameworkï¼Œå…·ä½“åšæ³•å‚è€ƒ&lt;a href=&quot;https://github.com/kstenerud/iOS-Universal-Framework&quot;&gt;è¿™é‡Œ&lt;/a&gt;å’Œ&lt;a href=&quot;https://github.com/jverkoey/iOS-Framework&quot;&gt;è¿™é‡Œ&lt;/a&gt;ï¼Œè¿™ç§æ–¹æ³•äº§ç”Ÿçš„ Framework è¿˜æœ‰ â€œä¼ªâ€(Fake) Framework å’Œ â€œçœŸâ€(Real) Framework çš„åŒºåˆ«ã€‚&lt;/p&gt;

&lt;p&gt;iOS 8/Xcode 6 æ¨å‡ºä¹‹åï¼ŒiOS å¹³å°æ·»åŠ äº†åŠ¨æ€åº“çš„æ”¯æŒï¼ŒåŒæ—¶ Xcode 6 ä¹ŸåŸç”Ÿè‡ªå¸¦äº† Framework æ”¯æŒï¼ˆåŠ¨æ€å’Œé™æ€éƒ½å¯ä»¥ï¼‰ï¼Œä¸Šé¢æåˆ°çš„çš„å¥‡æŠ€æ·«å·§ä¹Ÿå°±æ²¡æœ‰å¿…è¦äº†ï¼ˆæ–°çš„åšæ³•å‚è€ƒ&lt;a href=&quot;http://www.cocoachina.com/ios/20141126/10322.html&quot;&gt;è¿™é‡Œ&lt;/a&gt;ï¼‰ã€‚ä¸ºä»€ä¹ˆ iOS 8 è¦æ·»åŠ åŠ¨æ€åº“çš„æ”¯æŒï¼Ÿå”¯ä¸€çš„ç†ç”±å¤§æ¦‚å°±æ˜¯ Extension çš„å‡ºç°ã€‚Extension å’Œ App æ˜¯ä¸¤ä¸ªåˆ†å¼€çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒåŒæ—¶éœ€è¦å…±äº«ä»£ç ï¼Œè¿™ç§æƒ…å†µä¸‹åŠ¨æ€åº“çš„æ”¯æŒå°±æ˜¯å¿…ä¸å¯å°‘çš„äº†ã€‚ä½†æ˜¯è¿™ç§åŠ¨æ€ Framework å’Œç³»ç»Ÿçš„ UIKit.Framework è¿˜æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«ã€‚ç³»ç»Ÿçš„ Framework ä¸éœ€è¦æ‹·è´åˆ°ç›®æ ‡ç¨‹åºä¸­ï¼Œæˆ‘ä»¬è‡ªå·±åšå‡ºæ¥çš„ Framework å“ªæ€•æ˜¯åŠ¨æ€çš„ï¼Œæœ€åä¹Ÿè¿˜æ˜¯è¦æ‹·è´åˆ° App ä¸­ï¼ˆApp å’Œ Extension çš„ Bundle æ˜¯å…±äº«çš„ï¼‰ï¼Œå› æ­¤è‹¹æœåˆæŠŠè¿™ç§ Framework ç§°ä¸º &lt;a href=&quot;https://developer.apple.com/library/prerelease/ios/documentation/General/Conceptual/ExtensibilityPG/ExtensionScenarios.html&quot;&gt;Embedded Framework&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h4 id=&quot;swift-æ”¯æŒ&quot;&gt;Swift æ”¯æŒ&lt;/h4&gt;

&lt;p&gt;è·Ÿç€ iOS8 / Xcode 6 åŒæ—¶å‘å¸ƒçš„è¿˜æœ‰ Swiftã€‚å¦‚æœè¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¤–éƒ¨çš„ä»£ç ï¼Œå¯é€‰çš„æ–¹å¼åªæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯æŠŠä»£ç æ‹·è´åˆ°å·¥ç¨‹ä¸­ï¼Œå¦ä¸€ç§æ˜¯ç”¨åŠ¨æ€ Frameworkã€‚ä½¿ç”¨é™æ€åº“æ˜¯ä¸æ”¯æŒçš„ã€‚&lt;/p&gt;

&lt;p&gt;é€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› ä¸»è¦æ˜¯ Swift çš„è¿è¡Œåº“æ²¡æœ‰è¢«åŒ…å«åœ¨ iOS ç³»ç»Ÿä¸­ï¼Œè€Œæ˜¯ä¼šæ‰“åŒ…è¿› App ä¸­ï¼ˆè¿™ä¹Ÿæ˜¯é€ æˆ Swift App ä½“ç§¯å¤§çš„åŸå› ï¼‰ï¼Œé™æ€åº“ä¼šå¯¼è‡´æœ€ç»ˆçš„ç›®æ ‡ç¨‹åºä¸­åŒ…å«é‡å¤çš„è¿è¡Œåº“ï¼ˆè¿™æ˜¯&lt;a href=&quot;https://github.com/ksm/SwiftInFlux#static-libraries&quot;&gt;è‹¹æœè‡ªå®¶çš„è§£é‡Š&lt;/a&gt;ï¼‰ã€‚åŒæ—¶æ‹·è´ Runtime è¿™ç§åšæ³•ä¹Ÿä¼šå¯¼è‡´åœ¨çº¯ ObjC çš„é¡¹ç›®ä¸­ä½¿ç”¨ Swift åº“å‡ºç°é—®é¢˜ã€‚è‹¹æœå£°ç§°ç­‰åˆ° Swift çš„ Runtime ç¨³å®šä¹‹åä¼šè¢«åŠ å…¥åˆ°ç³»ç»Ÿå½“ä¸­ï¼Œåˆ°æ—¶å€™è¿™ä¸ªé™åˆ¶å°±ä¼šè¢«å»é™¤äº†ï¼ˆå‚è€ƒ&lt;a href=&quot;https://stackoverflow.com/questions/25020783/how-to-distribute-swift-library-without-exposing-the-source-code&quot;&gt;è¿™ä¸ªé—®é¢˜&lt;/a&gt; çš„é—®é¢˜æè¿°ï¼Œä¹Ÿæ˜¯æ¥è‡ªè‹¹æœè‡ªå®¶æ–‡æ¡£ï¼‰ã€‚&lt;/p&gt;

&lt;h4 id=&quot;cocoapods-çš„åšæ³•&quot;&gt;CocoaPods çš„åšæ³•&lt;/h4&gt;

&lt;p&gt;åœ¨çº¯ ObjC çš„é¡¹ç›®ä¸­ï¼ŒCocoaPods ä½¿ç”¨ç¼–è¯‘é™æ€åº“ .a æ–¹æ³•å°†ä»£ç é›†æˆåˆ°é¡¹ç›®ä¸­ã€‚åœ¨ Pods é¡¹ç›®ä¸­çš„æ¯ä¸ª target éƒ½å¯¹åº”è¿™ä¸€ä¸ª Pod çš„é™æ€åº“ã€‚ä¸è¿‡åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å¹¶ä¸ä¼šçœŸçš„äº§å‡º .a æ–‡ä»¶ã€‚å¦‚æœéœ€è¦ .a æ–‡ä»¶çš„è¯ï¼Œå¯ä»¥å‚è€ƒ&lt;a href=&quot;http://www.cnblogs.com/brycezhang/p/4117180.html&quot;&gt;è¿™é‡Œ&lt;/a&gt;ï¼Œæˆ–è€…ä½¿ç”¨ &lt;a href=&quot;https://github.com/CocoaPods/cocoapods-packager&quot;&gt;CocoasPods-Packager&lt;/a&gt; è¿™ä¸ªæ’ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;å½“ä¸æƒ³å‘å¸ƒä»£ç çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Framework å‘å¸ƒ Podï¼ŒCocoaPods æä¾›äº† &lt;code class=&quot;highlighter-rouge&quot;&gt;vendored_framework&lt;/code&gt; é€‰é¡¹æ¥ä½¿ç”¨ç¬¬ä¸‰æ–¹ Frameworkï¼Œå…·ä½“çš„åšæ³•å¯ä»¥å‚è€ƒ&lt;a href=&quot;http://www.telerik.com/blogs/how-to-use-a-third-party-framework-in-a-private-cocoapod&quot;&gt;è¿™é‡Œ&lt;/a&gt;å’Œ&lt;a href=&quot;https://stackoverflow.com/questions/18219286/podspec-link-binary-library&quot;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äº Swift é¡¹ç›®ï¼ŒCocoaPods æä¾›äº†åŠ¨æ€ Framework çš„æ”¯æŒã€‚é€šè¿‡ &lt;code class=&quot;highlighter-rouge&quot;&gt;use_frameworks!&lt;/code&gt; é€‰é¡¹æ§åˆ¶ã€‚å¯¹äº Swift å†™çš„åº“æ¥è¯´ï¼Œæƒ³é€šè¿‡ CocoaPods å¼•å…¥å·¥ç¨‹ï¼Œå¿…é¡»åŠ å…¥ &lt;code class=&quot;highlighter-rouge&quot;&gt;use_frameworks!&lt;/code&gt; é€‰é¡¹ã€‚å…·ä½“åŸå› å‚è§ä¸Šä¸€èŠ‚å¯¹äº Swift éƒ¨åˆ†çš„ä»‹ç»ã€‚&lt;/p&gt;

&lt;p&gt;å¼•ç”¨ï¼š&lt;/p&gt;

&lt;p&gt;https://blog.csdn.net/hello_hwc/article/details/78317863&lt;/p&gt;

&lt;p&gt;WWDC 2017: &lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2017/413/&quot;&gt;App Startup Time: Past, Present, and Future&lt;/a&gt;&lt;/p&gt;</content><author><name>Ted</name></author><category term="iOS" /><summary type="html">ä¸€ã€å¯åŠ¨è¿‡ç¨‹</summary></entry><entry><title type="html">APPç”Ÿæˆä¸è¿è¡Œ(ä¸€)</title><link href="http://www.helloted.com/ios/2018/03/29/app-1/" rel="alternate" type="text/html" title="APPç”Ÿæˆä¸è¿è¡Œ(ä¸€)" /><published>2018-03-29T20:00:00+08:00</published><updated>2018-03-29T20:00:00+08:00</updated><id>http://www.helloted.com/ios/2018/03/29/app-1</id><content type="html" xml:base="http://www.helloted.com/ios/2018/03/29/app-1/">&lt;h3 id=&quot;ä¸€ç¼–è¯‘&quot;&gt;ä¸€ã€ç¼–è¯‘&lt;/h3&gt;

&lt;h4 id=&quot;æ±‡ç¼–&quot;&gt;æ±‡ç¼–&lt;/h4&gt;

&lt;p&gt;CPU ç”±ä¸Šäº¿ä¸ªæ™¶ä½“ç®¡ç»„æˆï¼Œåœ¨è¿è¡Œçš„æ—¶å€™ï¼Œå•ä¸ªæ™¶ä½“ç®¡åªèƒ½æ ¹æ®ç”µæµçš„æµé€šæˆ–å…³é—­æ¥ç¡®è®¤ä¸¤ç§çŠ¶æ€ï¼Œæˆ‘ä»¬ä¸€èˆ¬è¯´ 0 æˆ– 1ï¼Œæ ¹æ®è¿™ç§çŠ¶æ€ï¼Œäººç±»åˆ›é€ äº†äºŒè¿›åˆ¶ï¼Œé€šè¿‡äºŒè¿›åˆ¶ç¼–ç æˆ‘ä»¬å¯ä»¥è¡¨ç¤ºæ‰€æœ‰çš„æ¦‚å¿µã€‚ä½†æ˜¯ï¼ŒCPU ä¾ç„¶åªèƒ½æ‰§è¡ŒäºŒè¿›åˆ¶ä»£ç ã€‚æˆ‘ä»¬å°†ä¸€ç»„äºŒè¿›åˆ¶ä»£ç åˆå¹¶æˆä¸€ä¸ªæŒ‡ä»¤æˆ–ç¬¦å·ï¼Œåˆ›é€ äº†æ±‡ç¼–è¯­è¨€ï¼Œæ±‡ç¼–è¯­è¨€ä»¥ä¸€ç§ç›¸å¯¹å¥½ç†è§£çš„æ–¹å¼æ¥ç¼–å†™ï¼Œç„¶åé€šè¿‡æ±‡ç¼–è¿‡ç¨‹ç”Ÿæˆ CPU å¯ä»¥è¿è¡Œçš„äºŒè¿›åˆ¶ä»£ç å¹¶è¿è¡Œåœ¨ CPU ä¸Šã€‚&lt;/p&gt;

&lt;h4 id=&quot;ç¼–è¯‘&quot;&gt;ç¼–è¯‘&lt;/h4&gt;

&lt;p&gt;ç¼–è¯‘å™¨å°†åŸå§‹ç¨‹åºï¼ˆSource programï¼‰ä½œä¸ºè¾“å…¥ï¼Œç¿»è¯‘äº§ç”Ÿä½¿ç”¨ç›®æ ‡è¯­è¨€ï¼ˆTarget languageï¼‰çš„ç­‰ä»·ç¨‹åºã€‚æºä»£ç ä¸€èˆ¬ä¸ºé«˜é˜¶è¯­è¨€ (High-level language), å¦‚Cã€C++ã€C# ã€Objective-Cã€Swiftã€Java ç­‰ï¼Œè€Œç›®æ ‡è¯­è¨€åˆ™æ˜¯æ±‡ç¼–è¯­è¨€æˆ–ç›®æ ‡æœºå™¨çš„ç›®æ ‡ä»£ç ï¼ˆObject codeï¼‰ï¼Œæœ‰æ—¶ä¹Ÿç§°ä½œæœºå™¨ä»£ç ï¼ˆMachine codeï¼‰&lt;/p&gt;

&lt;h4 id=&quot;ç¼–è¯‘å‹è¯­è¨€å’Œè§£é‡Šå‹è¯­è¨€&quot;&gt;ç¼–è¯‘å‹è¯­è¨€å’Œè§£é‡Šå‹è¯­è¨€&lt;/h4&gt;

&lt;p&gt;ç¼–è¯‘ç¨‹åºæ˜¯æ•´ä½“ç¼–è¯‘å®Œäº†ï¼Œå†ä¸€æ¬¡æ€§æ‰§è¡Œã€‚ è€Œè§£é‡Šç¨‹åºæ˜¯ä¸€è¾¹è§£é‡Šï¼Œä¸€è¾¹æ‰§è¡Œã€‚&lt;/p&gt;

&lt;p&gt;ç¼–è¯‘å‹è¯­è¨€ï¼šCç³»ï¼Œjava&lt;/p&gt;

&lt;p&gt;è§£é‡Šå‹è¯­è¨€ï¼šhtmlã€javascript&lt;/p&gt;

&lt;h3 id=&quot;äºŒllvmclang&quot;&gt;äºŒã€LLVMã€Clang&lt;/h3&gt;

&lt;h4 id=&quot;llvm&quot;&gt;LLVM&lt;/h4&gt;

&lt;p&gt;LLVMæœ¬èº«å¹¶ä¸æ˜¯ç¼–è¯‘å™¨ï¼Œåªæ˜¯ä¸€å¥—ç”¨äºå¼€å‘ç¼–è¯‘å™¨ã€è§£é‡Šå™¨ç­‰ç¨‹åºè¯­è¨€ç›¸å…³å·¥å…·çš„åº“ï¼Œä¸»è¦èšç„¦äºç¼–è¯‘å™¨åç«¯åŠŸèƒ½ï¼Œå¦‚ä»£ç ç”Ÿæˆã€ä»£ç ä¼˜åŒ–ã€JITç­‰ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;LLVM&lt;a href=&quot;http://www.aosabook.org/en/llvm.html#footnote-1&quot;&gt;1&lt;/a&gt; an umbrella project that hosts and develops a set of close-knit low-level toolchain components (e.g., assemblers, compilers, debuggers, etc.)&lt;/p&gt;

  &lt;p&gt;LLVM æ˜¯ä¸€ä¸ªæ¶µç›–å’Œå¼€å‘ä¸€ç³»åˆ—ç´§å¯†ç»“åˆçš„ä½çº§å·¥å…·é“¾ç»„ä»¶ï¼ˆä¾‹å¦‚ï¼Œæ±‡ç¼–å™¨ï¼Œç¼–è¯‘å™¨ï¼Œè°ƒè¯•å™¨ç­‰ï¼‰çš„ç»¼åˆé¡¹ç›®&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä¼ ç»Ÿçš„ç¼–è¯‘å™¨é€šå¸¸åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œå‰ç«¯(frontEnd)ï¼Œä¼˜åŒ–å™¨(Optimizer)å’Œåç«¯(backEnd)ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå‰ç«¯ä¸»è¦è´Ÿè´£è¯æ³•å’Œè¯­æ³•åˆ†æï¼Œå°†æºä»£ç è½¬åŒ–ä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼›ä¼˜åŒ–å™¨åˆ™æ˜¯åœ¨å‰ç«¯çš„åŸºç¡€ä¸Šï¼Œå¯¹å¾—åˆ°çš„ä¸­é—´ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä½¿ä»£ç æ›´åŠ é«˜æ•ˆï¼›åç«¯åˆ™æ˜¯å°†å·²ç»ä¼˜åŒ–çš„ä¸­é—´ä»£ç è½¬åŒ–ä¸ºé’ˆå¯¹å„è‡ªå¹³å°çš„æœºå™¨ä»£ç ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/05.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;clang&quot;&gt;Clang&lt;/h4&gt;

&lt;p&gt;Clang æ˜¯ä¸€ä¸ªCã€C++ã€Objective-Cå’ŒObjective-C++ç¼–ç¨‹è¯­è¨€çš„ç¼–è¯‘å™¨å‰ç«¯ã€‚å®ƒé‡‡ç”¨äº†LLVMä½œä¸ºå…¶åç«¯ã€‚&lt;/p&gt;

&lt;p&gt;Clangæ˜¯2005å¹´ç”±è‹¹æœç”µè„‘å‘èµ·ï¼Œæ˜¯LLVMç¼–è¯‘å™¨å·¥å…·é›†çš„å‰ç«¯ï¼ˆfront-endï¼‰ï¼Œç›®çš„æ˜¯è¾“å‡ºä»£ç å¯¹åº”çš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Tree, ASTï¼‰ï¼Œå¹¶å°†ä»£ç ç¼–è¯‘æˆLLVM Bitcodeã€‚æ¥ç€åœ¨åç«¯ï¼ˆback-endï¼‰ä½¿ç”¨LLVMç¼–è¯‘æˆå¹³å°ç›¸å…³çš„æœºå™¨è¯­è¨€ ã€‚Clangæ”¯æŒCã€C++ã€Objective Cã€‚&lt;/p&gt;

&lt;p&gt;Clangæœ¬èº«æ€§èƒ½ä¼˜å¼‚ï¼Œå…¶ç”Ÿæˆçš„ASTæ‰€è€—ç”¨æ‰çš„å†…å­˜ä»…ä»…æ˜¯GCCçš„20%å·¦å³ï¼Œæµ‹è¯•è¯æ˜Clangç¼–è¯‘Objective-Cä»£ç æ—¶é€Ÿåº¦ä¸ºGCCçš„3å€ï¼Œè¿˜èƒ½é’ˆå¯¹ç”¨æˆ·å‘ç”Ÿçš„ç¼–è¯‘é”™è¯¯å‡†ç¡®åœ°ç»™å‡ºå»ºè®®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ä¸‰iosä¸­çš„ç¼–è¯‘&quot;&gt;ä¸‰ã€iOSä¸­çš„ç¼–è¯‘&lt;/h3&gt;

&lt;p&gt;Objective Cé‡‡ç”¨Clangä½œä¸ºå‰ç«¯ï¼Œè€ŒSwiftåˆ™é‡‡ç”¨swift()ä½œä¸ºå‰ç«¯ï¼ŒäºŒè€…LLVM(Low level vritual machine)ä½œä¸ºç¼–è¯‘å™¨åç«¯ã€‚ç¼–è¯‘è¿‡ç¨‹å¦‚ä¸‹å›¾&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/06.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥çœ‹çœ‹ä¸€ä¸ªæ–‡ä»¶çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œæ–°å»ºTest.m&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#import &amp;lt;Foundation/Foundation.h&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;err&quot;&gt;@autoreleasepool&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;%@&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;Hello Leo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ç»ˆç«¯è¾“å…¥ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;clang -ccc-print-phases -framework Foundation test.m -o test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¼šçœ‹åˆ°ä¸‹åˆ—çš„ï¼š&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0: input, &lt;span class=&quot;s2&quot;&gt;&quot;Foundation&quot;&lt;/span&gt;, object 
1: input, &lt;span class=&quot;s2&quot;&gt;&quot;test.m&quot;&lt;/span&gt;, objective-c
2: preprocessor, &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;, objective-c-cpp-output//é¢„å¤„ç†
3: compiler, &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;2&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;, ir //ç¼–è¯‘ç”ŸæˆIR&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ä¸­é—´ä»£ç &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
4: backend, &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;3&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;, assembler//æ±‡ç¼–å™¨ç”Ÿæˆæ±‡ç¼–ä»£ç 
5: assembler, &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;4&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;, object//ç”Ÿæˆæœºå™¨ç 
6: linker, &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;0, 5&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;, image//é“¾æ¥
7: bind-arch, &lt;span class=&quot;s2&quot;&gt;&quot;x86_64&quot;&lt;/span&gt;, &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;6&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;, image//ç”ŸæˆImageï¼Œä¹Ÿå°±æ˜¯æœ€åçš„å¯æ‰§è¡Œæ–‡ä»¶
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;ç¼–è¯‘å™¨å‰ç«¯&quot;&gt;ç¼–è¯‘å™¨å‰ç«¯&lt;/h4&gt;

&lt;p&gt;ç¼–è¯‘å™¨å‰ç«¯çš„ä»»åŠ¡æ˜¯è¿›è¡Œï¼šè¯­æ³•åˆ†æï¼Œè¯­ä¹‰åˆ†æï¼Œç”Ÿæˆä¸­é—´ä»£ç (intermediate representation )ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œå¦‚æœå‘ç°é”™è¯¯æˆ–è€…è­¦å‘Šä¼šæ ‡æ³¨å‡ºæ¥åœ¨å“ªä¸€è¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/07.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ç¼–è¯‘å™¨ä¼˜åŒ–&quot;&gt;ç¼–è¯‘å™¨ä¼˜åŒ–&lt;/h4&gt;

&lt;p&gt;LVVMä¼˜åŒ–å™¨ä¼šè¿›è¡ŒBitCodeçš„ç”Ÿæˆï¼Œé“¾æ¥æœŸä¼˜åŒ–ç­‰ç­‰&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/08.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ç¼–è¯‘å™¨åç«¯&quot;&gt;ç¼–è¯‘å™¨åç«¯&lt;/h4&gt;

&lt;p&gt;LLVMæœºå™¨ç ç”Ÿæˆå™¨ä¼šé’ˆå¯¹ä¸åŒçš„æ¶æ„ï¼Œæ¯”å¦‚arm64ç­‰ç”Ÿæˆä¸åŒçš„æœºå™¨ç &lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/09.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;å››xcodeæ‰§è¡Œbuildçš„æµç¨‹&quot;&gt;å››ã€Xcodeæ‰§è¡ŒBuildçš„æµç¨‹&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;ç¼–è¯‘ä¿¡æ¯å†™å…¥è¾…åŠ©æ–‡ä»¶ï¼Œåˆ›å»ºç¼–è¯‘åçš„æ–‡ä»¶æ¶æ„(name.app)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å†™å…¥è¾…åŠ©æ–‡ä»¶ï¼šå°†é¡¹ç›®çš„æ–‡ä»¶ç»“æ„å¯¹åº”è¡¨ã€å°†è¦æ‰§è¡Œçš„è„šæœ¬ã€é¡¹ç›®ä¾èµ–åº“çš„æ–‡ä»¶ç»“æ„å¯¹åº”è¡¨å†™æˆæ–‡ä»¶ï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è¿è¡Œé¢„è®¾è„šæœ¬ï¼šCocoapods ä¼šé¢„è®¾ä¸€äº›è„šæœ¬ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå·±é¢„è®¾ä¸€äº›è„šæœ¬æ¥è¿è¡Œã€‚è¿™äº›è„šæœ¬éƒ½åœ¨ Build Phases ä¸­å¯ä»¥çœ‹åˆ°ï¼›&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ç¼–è¯‘æ–‡ä»¶ï¼šé’ˆå¯¹æ¯ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ Mach-Oï¼Œè¿™è¿‡ç¨‹ LLVM çš„å®Œæ•´æµç¨‹ï¼Œå‰ç«¯ã€ä¼˜åŒ–å™¨ã€åç«¯ï¼›ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;CompileC&lt;/code&gt;å’Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;clang&lt;/code&gt;å‘½ä»¤ã€‚&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CompileC ClassName.o ClassName.m normal x86_64 objective-c com.apple.compilers.llvm.clang.1_0.compiler
export LANG=en_US.US-ASCII
export PATH=&quot;...&quot;
clang -x objective-c -arch x86_64 -fmessage-length=0 -fobjc-arc... -Wno-missing-field-initializers ... -DDEBUG=1 ... -isysroot iPhoneSimulator10.1.sdk -fasm-blocks ... -I ä¸Šæ–‡æåˆ°çš„æ–‡ä»¶ -F æ‰€éœ€è¦çš„Framework  -iquote æ‰€éœ€è¦çš„Framework  ... -c ClassName.c -o ClassName.o
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;clangæ˜¯å®é™…çš„ç¼–è¯‘å‘½ä»¤
-x      objective-c æŒ‡å®šäº†ç¼–è¯‘çš„è¯­è¨€
-arch   x86_64åˆ¶å®šäº†ç¼–è¯‘çš„æ¶æ„ï¼Œç±»ä¼¼è¿˜æœ‰arm7ç­‰
-fobjc-arc ä¸€äº›åˆ—-få¼€å¤´çš„ï¼ŒæŒ‡å®šäº†é‡‡ç”¨arcç­‰ä¿¡æ¯ã€‚è¿™ä¸ªä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä½ å¯ä»¥å¯¹å•ç‹¬çš„ä¸€ä¸ª.mæ–‡ä»¶é‡‡ç”¨éARCç¼–ç¨‹ã€‚
-Wno-missing-field-initializers ä¸€ç³»åˆ—ä»¥-Wå¼€å¤´çš„ï¼ŒæŒ‡çš„æ˜¯ç¼–è¯‘çš„è­¦å‘Šé€‰é¡¹ï¼Œé€šè¿‡è¿™äº›ä½ å¯ä»¥å®šåˆ¶åŒ–ç¼–è¯‘é€‰é¡¹
-DDEBUG=1 ä¸€äº›åˆ—-Då¼€å¤´çš„ï¼ŒæŒ‡çš„æ˜¯é¢„ç¼–è¯‘å®ï¼Œé€šè¿‡è¿™äº›å®å¯ä»¥å®ç°æ¡ä»¶ç¼–è¯‘
-iPhoneSimulator10.1.sdk åˆ¶å®šäº†ç¼–è¯‘é‡‡ç”¨çš„iOS SDKç‰ˆæœ¬
-I æŠŠç¼–è¯‘ä¿¡æ¯å†™å…¥æŒ‡å®šçš„è¾…åŠ©æ–‡ä»¶
-F é“¾æ¥æ‰€éœ€è¦çš„Framework
-c ClassName.c ç¼–è¯‘æ–‡ä»¶
-o ClassName.o ç¼–è¯‘äº§ç‰©
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;é“¾æ¥åº“ï¼Œä¾‹å¦‚&lt;code class=&quot;highlighter-rouge&quot;&gt;Foundation.framework&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;AFNetworking.framework&lt;/code&gt;â€¦&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æ‹·è´èµ„æºæ–‡ä»¶ï¼šå°†é¡¹ç›®ä¸­çš„èµ„æºæ–‡ä»¶æ‹·è´åˆ°ç›®æ ‡åŒ…ï¼›&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ç¼–è¯‘ storyboard æ–‡ä»¶ï¼šstoryboard æ–‡ä»¶ä¹Ÿæ˜¯ä¼šè¢«ç¼–è¯‘çš„ï¼›&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;é“¾æ¥ storyboard æ–‡ä»¶ï¼šå°†ç¼–è¯‘åçš„ storyboard æ–‡ä»¶é“¾æ¥æˆä¸€ä¸ªæ–‡ä»¶ï¼›&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ç¼–è¯‘ Asset æ–‡ä»¶ï¼šæˆ‘ä»¬çš„å›¾ç‰‡å¦‚æœä½¿ç”¨ Assets.xcassets æ¥ç®¡ç†å›¾ç‰‡ï¼Œé‚£ä¹ˆè¿™äº›å›¾ç‰‡å°†ä¼šè¢«ç¼–è¯‘æˆæœºå™¨ç ï¼Œé™¤äº† icon å’Œ launchImageï¼›&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è¿è¡Œ Cocoapods è„šæœ¬ï¼šå°†åœ¨ç¼–è¯‘é¡¹ç›®ä¹‹å‰å·²ç»ç¼–è¯‘å¥½çš„ä¾èµ–åº“å’Œç›¸å…³èµ„æºæ‹·è´åˆ°åŒ…ä¸­ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;åˆ›å»º.appæ–‡ä»¶å’Œå¯¹å…¶ç­¾å&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;dsym-æ–‡ä»¶&quot;&gt;dSYM æ–‡ä»¶&lt;/h4&gt;

&lt;p&gt;æˆ‘ä»¬åœ¨æ¯æ¬¡ç¼–è¯‘è¿‡åï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªdsymæ–‡ä»¶ã€‚dsymæ–‡ä»¶ä¸­ï¼Œå­˜å‚¨äº†16è¿›åˆ¶çš„å‡½æ•°åœ°å€æ˜ å°„ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨Appå®é™…æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæ˜¯é€šè¿‡åœ°å€æ¥è°ƒç”¨æ–¹æ³•çš„ã€‚åœ¨App crashçš„æ—¶å€™ï¼Œç¬¬ä¸‰æ–¹å·¥å…·ï¼ˆFabric,å‹ç›Ÿç­‰ï¼‰ä¼šå¸®æˆ‘ä»¬æŠ“åˆ°å´©æºƒçš„è°ƒç”¨æ ˆï¼Œè°ƒç”¨æ ˆé‡Œä¼šåŒ…å«crashåœ°å€çš„è°ƒç”¨ä¿¡æ¯ã€‚ç„¶åï¼Œé€šè¿‡dSYMæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”±åœ°å€æ˜ å°„åˆ°å…·ä½“çš„å‡½æ•°ä½ç½®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;äº”æé«˜é¡¹ç›®buildé€Ÿåº¦&quot;&gt;äº”ã€æé«˜é¡¹ç›®Buildé€Ÿåº¦&lt;/h3&gt;

&lt;h4 id=&quot;æŸ¥çœ‹ç¼–è¯‘æ—¶é—´&quot;&gt;æŸ¥çœ‹ç¼–è¯‘æ—¶é—´&lt;/h4&gt;

&lt;p&gt;æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé€”å¾„ï¼Œèƒ½å¤Ÿçœ‹åˆ°ç¼–è¯‘çš„æ—¶é—´ï¼Œè¿™æ ·æ‰èƒ½æœ‰ä¸ªå¯¹æ¯”ï¼ŒçŸ¥é“æˆ‘ä»¬çš„ä¼˜åŒ–ç©¶ç«Ÿæœ‰æ²¡æœ‰æ•ˆæœã€‚ 
å¯¹äºXCode 8ï¼Œå…³é—­XCodeï¼Œç»ˆç«¯è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ defaults write com.apple.dt.Xcode ShowBuildOperationDuration YES
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;ä»£ç ä¼˜åŒ–-forward-declaration&quot;&gt;ä»£ç ä¼˜åŒ–-&lt;strong&gt;forward declaration&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@class CLASSNAME&lt;/code&gt;ï¼Œè€Œä¸æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;#import CLASSNAME.h&lt;/code&gt;ã€‚è¿™æ ·ï¼Œç¼–è¯‘å™¨èƒ½å¤§å¤§æé«˜#importçš„æ›¿æ¢é€Ÿåº¦ã€‚&lt;/p&gt;

&lt;h4 id=&quot;å¯¹å¸¸ç”¨å·¥å…·ç±»æ‰“åŒ…&quot;&gt;å¯¹å¸¸ç”¨å·¥å…·ç±»æ‰“åŒ…&lt;/h4&gt;

&lt;p&gt;æ‰“åŒ…æˆFrameworkæˆ–è€…é™æ€åº“ï¼Œè¿™æ ·ç¼–è¯‘çš„æ—¶å€™è¿™éƒ¨åˆ†ä»£ç å°±ä¸éœ€è¦é‡æ–°ç¼–è¯‘äº†ã€‚&lt;/p&gt;

&lt;h4 id=&quot;å¸¸ç”¨å¤´æ–‡ä»¶æ”¾åˆ°é¢„ç¼–è¯‘æ–‡ä»¶é‡Œ&quot;&gt;å¸¸ç”¨å¤´æ–‡ä»¶æ”¾åˆ°é¢„ç¼–è¯‘æ–‡ä»¶é‡Œ&lt;/h4&gt;

&lt;p&gt;XCodeçš„pchæ–‡ä»¶æ˜¯é¢„ç¼–è¯‘æ–‡ä»¶ï¼Œè¿™é‡Œçš„å†…å®¹åœ¨æ‰§è¡ŒXCode buildä¹‹å‰å°±å·²ç»è¢«é¢„ç¼–è¯‘ï¼Œå¹¶ä¸”å¼•å…¥åˆ°æ¯ä¸€ä¸ª.mæ–‡ä»¶é‡Œäº†ã€‚&lt;/p&gt;

&lt;p&gt;ç¼–è¯‘å™¨é€‰é¡¹ä¼˜åŒ–&lt;/p&gt;

&lt;h4 id=&quot;debugæ¨¡å¼ä¸‹ä¸ç”Ÿæˆdsymæ–‡ä»¶&quot;&gt;Debugæ¨¡å¼ä¸‹ï¼Œä¸ç”Ÿæˆdsymæ–‡ä»¶&lt;/h4&gt;

&lt;p&gt;ä¸Šæ–‡æåˆ°äº†ï¼Œdysmæ–‡ä»¶é‡Œå­˜å‚¨äº†è°ƒè¯•ä¿¡æ¯ï¼Œåœ¨Debugæ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©XCodeå’ŒLLDBè¿›è¡Œè°ƒè¯•ã€‚æ‰€ä»¥ï¼Œä¸éœ€è¦ç”Ÿæˆé¢å¤–çš„dsymæ–‡ä»¶æ¥é™ä½ç¼–è¯‘é€Ÿåº¦ã€‚&lt;/p&gt;

&lt;h4 id=&quot;debugå¼€å¯build-active-architecture-only&quot;&gt;Debugå¼€å¯&lt;code class=&quot;highlighter-rouge&quot;&gt;Build Active Architecture Only&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;åœ¨XCode -&amp;gt; Build Settings -&amp;gt; Build Active Architecture Only æ”¹ä¸ºYESã€‚è¿™æ ·åšï¼Œå¯ä»¥åªç¼–è¯‘å½“å‰çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚arm7/arm64ç­‰ç­‰ï¼Œè®°å¾—åªå¼€å¯Debugæ¨¡å¼ã€‚è¿™ä¸ªé€‰é¡¹åœ¨é«˜ç‰ˆæœ¬çš„XCodeä¸­è‡ªåŠ¨å¼€å¯äº†ã€‚&lt;/p&gt;

&lt;h4 id=&quot;debugæ¨¡å¼ä¸‹å…³é—­ç¼–è¯‘å™¨ä¼˜åŒ–&quot;&gt;Debugæ¨¡å¼ä¸‹ï¼Œå…³é—­ç¼–è¯‘å™¨ä¼˜åŒ–&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/img/Simple_7/10.png&quot; alt=&quot;img&quot; /&gt;&lt;/p&gt;</content><author><name>Ted</name></author><category term="iOS" /><summary type="html">ä¸€ã€ç¼–è¯‘</summary></entry></feed>